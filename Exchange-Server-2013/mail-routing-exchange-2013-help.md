---
title: 'メール ルーティング: Exchange 2013 Help'
TOCTitle: メール ルーティング
ms:assetid: 6fd39079-9655-4fd9-9269-c7462c76e0a7
ms:mtpsurl: https://technet.microsoft.com/ja-jp/library/Aa998825(v=EXCHG.150)
ms:contentKeyID: 48269630
ms.date: 04/24/2018
mtps_version: v=EXCHG.150
ms.translationtype: HT
---

# メール ルーティング

 

_**適用先:** Exchange Server 2013_

_**トピックの最終更新日:** 2015-03-09_

Microsoft Exchange Server 2013 組織内のすべてのメールボックス サーバーに存在するトランスポート サービスの主なタスクは、ユーザーや外部ソースから受信したメッセージを最終的な送信先にルーティングすることです。ルーティングの決定は、メッセージの分類時に行われます。カテゴライザーは、メールボックス サーバー上のトランスポート サービスのコンポーネントで、すべての受信メッセージを処理し、宛先の情報に基づいてメッセージの処理を決定します。

Exchange 2013 でのルーティングは、データベース可用性グループ (DAG) を完全に認識し、DAG メンバーシップをルーティング境界として使用します。理由は、Exchange 2013 では、すべてのメールボックス サーバーがトランスポート サービスをホストします。したがって、メールボックス サーバーが DAG に属している場合、ルーティング メッセージの主要メカニズムは DAG と緊密に連携します。DAG が複数の Active Directory サイトにわたる場合、Active Directory サイトをプライマリ ルーティング境界として使用することは非効率的です。また、旧バージョンの Exchange とのルーティングの相互運用性を目的に、Exchange 2013 も Active Directory サイトのメンバーシップを DAG に属さないメールボックス サーバーのルーティング境界として使用します。この他に、Exchange 2013 のルーティングには、次のような大きな変更点があります。

  - メールボックス サーバー上のトランスポート サービスが、メールボックス データベースと直接通信することはありません。代わりに、トランスポート サービスはメールボックス サーバー上のメールボックス トランスポート サービスと通信します。メールボックス トランスポート サービスだけが、ローカル メールボックス サーバー上のメールボックス データベースと通信します。メールボックス サーバーが DAG のメンバーとなっている場合、メールボックス データベースのアクティブ コピーを保持するメールボックス サーバー上のメールボックス トランスポート サービスだけが、宛先受信者へのメッセージを受け付けます。

  - リモート プロシージャ コール (RPC) は、ローカル メールボックス データベースとの間でメッセージを送受信する際に、メールボックス トランスポート サービスだけが使用します。メールボックス サーバーが DAG のメンバーとなっている場合、メールボックス トランスポート サービスはメールボックス データベースのアクティブ コピーとローカルに通信するときに限り、RPC を使用します。つまり、サーバー間通信には RPC が使用されません。代わりに、異なるメールボックス サーバー上のメールボックス トランスポート サービスとトランスポート サービスとの通信には、常に SMTP が使用されます。

  - Exchange 2013 がリモートの送信先に対するキューがより正確になりました。リモート Active Directory サイト内のすべての送信先に対して 1 つのキューを使用する代わりに、Exchange 2013 は Active Directory サイト内の特定の送信先 (たとえば、個々の送信コネクタ) のメッセージをキューに格納します。

  - リンクされたコネクタが廃止されました。リンクされたコネクタとは、送信コネクタにリンクされていた受信コネクタです。受信コネクタが受信したメッセージはすべて、自動的に送信コネクタに転送されていました。

**目次**

ルーティング コンポーネント

  - ルーティング先

  - 配信グループ

  - キュー

メッセージのルーティング

  - Active Directory サイト間でのメッセージのルーティング

  - クライアント アクセス サーバー上のフロントエンド トランスポート サービスでのルーティング

  - メールボックス サーバー上のメールボックス トランスポート サービスでのルーティング

  - エッジ トランスポート サーバー上のトランスポート サービスでのルーティング

## ルーティング コンポーネント

Exchange 2013 メールボックス サーバー上のトランスポート サーバーでメッセージが受信されると、メッセージの分類が必要になります。メッセージの分類の最初の段階は、受信者の解決です。受信者が解決された後に、最終的な送信先を決定できます。次の段階のルーティングでは、送信先への最適な到達方法を決定します。ルーティング先および配信グループ化の概念を導入することによって、Exchange 2013 のルーティングを汎用化し、柔軟性を高めると同時に複雑さを軽減しています。

## ルーティング先

Exchange 2013 では、最終的なメッセージ送信先は、*ルーティング先*と呼ばれています。Exchange 2013 には、次のルーティング先が存在します。

  - **メールボックス データベース**   Exchange 組織内のメールボックス サーバー上にメールボックスがある受信者のルーティング先です。Exchange 2013 では、パブリック フォルダーは一種のメールボックスであるため、パブリック フォルダー受信者宛てのメッセージのルーティングは、メールボックス受信者宛てのメッセージのルーティングと同じです。

  - **コネクタ**   コネクタは、ルーティング先として使用されたときに、SMTP メッセージ用の送信コネクタとなります。配信エージェント コネクタまたは外部コネクタは、SMTP 以外のメッセージのルーティング先として使用されます。

  - **配布グループの展開サーバー**   配布グループに、グループのメンバーシップ リストの展開を行う指定の展開サーバーがある場合のルーティング先です。配布グループ展開サーバーは、常にハブ トランスポート サーバーまたは Exchange 2013 メールボックス サーバーです。

これらと同じルーティング先は、以前のバージョンの Exchange にも存在しました。

ページのトップへ

## 配信グループ

Exchange 2013 では、各ルーティング先に、そのルーティング先へのメッセージ配信を担う 1 つ以上のトランスポート サーバーのコレクションが存在します。このトランスポート サーバーのコレクションを、*配信グループ*と呼びます。トランスポート サーバーは、Exchange 2013 メールボックス サーバーや Exchange 2010 サーバーである場合もあれば、ハブ トランスポート サーバーの役割がインストールされている Exchange 2007 サーバーであることもあります。ルーティング先がメールボックス データベースである場合、配信グループ内のトランスポート サーバーは、メールボックス データベースと同じバージョンの Exchange です。ルーティング先がコネクタまたは配布グループ展開サーバーである場合、配信グループ内に Exchange 2013 メールボックス サーバーと Exchange 2010 または Exchange 2007 ハブ トランスポート サーバーを混在させることができます。メッセージのルーティング方法は、宛先の配信グループとソース トランスポート サーバーの関係によって決まります。

  - ソース トランスポート サーバーが宛先の配信グループ内に存在する場合、ルーティング先自体はメッセージの次のホップです。メッセージは、ソース トランスポート サーバーによって、メールボックス データベース、または配信グループ内のトランスポート サーバー上のコネクタに配信されます。ルーティング先が配布グループ展開サーバーである場合、配布グループ展開サーバー上でメッセージが分類される段階になるまでに、配布グループが既に展開しています。したがって、配布グループ展開サーバーからのルーティング先は、常にメールボックス データベースまたはコネクタです。

  - ソース トランスポート サーバーが宛先配信グループの外部に存在する場合、メッセージは最小コストのルーティング パスに沿って宛先配信グループに中継されます。Exchange トポロジーのサイズおよび複雑さに応じて、メッセージは最小コストのルーティング パスに沿って他のトランスポート サーバーに中継されるか、または宛先配信グループ内のトランスポート サーバーに直接中継されます。

Exchange 2013 に存在する配信グループの種類は次のとおりです。

  - **ルーティング可能 DAG**   1 つの DAG に属する Exchange 2013 メールボックス サーバーのコレクションです。DAG 内のメールボックス データベースは、この配信グループによって処理されるルーティング先です。DAG に属するメールボックス サーバー上のトランスポート サービスにメッセージが到着すると、トランスポート サービスが、宛先メールボックス データベースのアクティブ コピーを現在保持する DAG 内のメールボックス サーバー上のメールボックス トランスポート サービスにメッセージをルーティングします。次に、メッセージは宛先メールボックス サーバー上のメールボックス トランスポート サービスを介して、ローカル メールボックス データベースに配信されます。DAG に、別の Active Directory サイトのメールボックス サーバーが含まれている場合もありますが、DAG は配信グループの境界です。

  - **メールボックス配信グループ**   1 つの Active Directory サイトに存在する同じバージョンの Exchange サーバーのコレクションです。Active Directory サイトは、配信グループの境界です。ルーティング先、およびそのルーティング先を処理する配信グループは、Active Directory サイト内にある Exchange の主要リリース バージョン別に選別されます。Exchange 2010 メールボックス サーバー上にあるメールボックス データベースは、Active Directory サイト内にある Exchange 2010 ハブ トランスポート サーバーによって処理されます。Exchange 2007 メールボックス サーバー上にあるメールボックス データベースは、Active Directory サイト内にある Exchange 2007 ハブ トランスポート サーバーによって処理されます。Active Directory サイト内の、DAG に属していない Exchange 2013 メールボックス サーバー上に置かれたメールボックス データベースは、Active Directory サイト内の Exchange 2013 メールボックス サーバー上のトランスポート サービスによって処理されます。メールボックス データベースへのメッセージ配信方法は、Exchange のバージョンによって決まります。
    
      - **Exchange 2013**   メッセージが宛先 Active Directory サイト内の宛先メールボックス サーバーに到着すると、トランスポート サービスが SMTP を使用してメセージをメールボックス トランスポート サービスに転送します。さらに、そのメールボックス トランスポート サービスは RPC を使用して、ローカル メールボックス データベースにメッセージを配信します。
    
      - **Exchange 2010 または Exchange 2007**   メッセージが宛先 Active Directory サイト内にある同じバージョンのいずれかのハブ トランスポート サーバーに到着すると、そのハブ トランスポート サーバー上のストア ドライバーが RPC を使用してメールボックス データベースにメッセージを書き込みます。

  - **コネクタの送信元サーバー**Exchange 2010 または Exchange 2007 ハブ トランスポート サーバー、または Exchange 2013 メールボックス サーバーの混在したコレクションであり、送信コネクタ、配信エージェント コネクタ、または外部コネクタの送信元サーバーとしてスコープが限定されています。コネクタは、このルーティング グループによって処理されるルーティング先です。コネクタのスコープが特定のサーバーである場合、そのサーバーだけが、コネクタによって定義された宛先へのメッセージのルーティングを許可されます。この配信グループには、別の Active Directory サイトに置かれている Exchange 2010 または Exchange 2007 ハブ トランスポート サーバーまたは Exchange 2013 メールボックス サーバーが含まれる場合があります。

  - **AD サイト**   状況によっては、Active Directory サイトがメッセージの最終的な送信先ではない場合もありますが、その場合でもメッセージは Active Directory サイト内の Exchange 2010 または Exchange 2007 ハブ トランスポート サーバー、または Exchange 2013 メールボックス サーバーを通過する必要があります。そのような状況としては以下が挙げられます。
    
      - Active Directory サイトがハブ サイトとして構成されている場合。メッセージ配信の最小コストのルーティング パス上にハブ サイトが存在する場合、メッセージは、最終的な送信先に中継される前に、ハブ サイトのトランスポート サーバーによってキューに入れられ、処理されます。
    
      - エッジ トランスポート サーバーが Active Directory サイトにサブスクライブされている場合。このようなエッジ トランスポート サーバーは、他の Active Directory サイトから直接にはアクセスできません。エッジ トランスポート サーバーには、Exchange 2013、Exchange 2010、または Exchange 2007 が使用可能です。
    

    > [!NOTE]
    > 配信グループが Active Directory サイトである場合に限り、遅延ファンアウトが使用されます。遅延ファンアウトは、複数の受信者が最小コストのルーティング パスのいずれかの部分を共有したときにメッセージ転送数を減らそうとします。



  - **サーバーの一覧**   配布グループの展開サーバーとして構成されている、1 つ以上の Exchange 2010 または Exchange 2007 ハブ トランスポート サーバー、または Exchange 2013 メールボックス サーバーのコレクションです。配布グループの展開サーバーは、この配布グループによって処理されるルーティング先です。

配信グループのメンバーシップは相互排他的ではありません。たとえば、DAG のメンバーである Exchange 2013 メールボックス サーバーも、スコープが限定された送信コネクタの送信元サーバーにできます。このメールボックス サーバーは、DAG 内のメールボックス データベースに対するルーティング可能な DAG 配信グループに属することができるほか、スコープが限定された送信コネクタに対するコネクタ ソース サーバー配信グループにも属することができます。

次の表は、関連する Exchange のバージョンに基づいてルーティング先を配信グループに対応付けたものです。


<table>
<colgroup>
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
</colgroup>
<thead>
<tr class="header">
<th></th>
<th>Exchange 2013 メールボックス サーバー</th>
<th>Exchange 2010 または Exchange 2007 ハブ トランスポート サーバー</th>
<th>境界ネットワーク内のエッジ トランスポート サーバー</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p>DAG 内のメールボックス データベース</p></td>
<td><p>ルーティング可能な DAG</p></td>
<td><p>メールボックス配信グループ</p></td>
<td><p>該当なし</p></td>
</tr>
<tr class="even">
<td><p>DAG に属さないメールボックス データベース</p></td>
<td><p>メールボックス配信グループ</p></td>
<td><p>メールボックス配信グループ</p></td>
<td><p>該当なし</p></td>
</tr>
<tr class="odd">
<td><p>コネクタ</p></td>
<td><p>コネクタの送信元サーバー</p></td>
<td><p>コネクタの送信元サーバー</p></td>
<td><p>AD サイト</p></td>
</tr>
<tr class="even">
<td><p>配布グループの展開サーバー</p></td>
<td><p>サーバー リスト</p></td>
<td><p>サーバー リスト</p></td>
<td><p>該当なし</p></td>
</tr>
</tbody>
</table>


ページのトップへ

## キュー

送信側サーバーの観点からすると、各配信キューは特定のメッセージの送信先を表します。Exchange 2013 メールボックス サーバー上のトランスポート サービスがメッセージの送信先を選択すると、送信先は受信者に **NextHopSolutionKey** 属性としてスタンプされます。単一のメッセージが複数の受信者に送信されている場合、各受信者は **NextHopSolutionKey** 属性を持ちます。受信側サーバーでもメッセージの分類を実行し、メッセージを配信用のキューに入れます。メッセージがキューに入れられた後には、特定のキューの配信の種類を確認して、次ホップの送信先への到達時にメッセージが再度中継されるかどうかを確認できます。**NextHopSolutionKey** 属性の一意の値はそれぞれ、個別の配信キューに対応します。

詳細については、「[キュー](queues-exchange-2013-help.md)」の「NextHopSolutionKey」セクションを参照してください。

ページのトップへ

## メッセージのルーティング

リモート配信グループに配信する必要のあるメッセージについては、そのルーティング パスを決定する必要があります。Exchange 2013 は、次のロジックを使用して、メッセージのルーティング パスを選択します。このロジックは、基本的に Exchange 2010 から変更がありません。

1.  送信先に到達するために通過する必要のある IP サイト リンクのコストを加算して、最小コストのルーティング パスを計算します。送信先がコネクタである場合、選択されたコネクタに到達するために、アドレス スペースに割り当てられたコストが追加されます。複数のルーティング パスが考えられる場合、総コストが最も低いルーティング パスが使用されます。

2.  複数のルーティング パスが同じ総コストになっている場合、各パスのホップ数が評価され、ホップ数の最も少ないルーティング パスが使用されます。

3.  それでも複数のルーティング パスが使用可能である場合、送信先の前にある Active Directory サイトに割り当てられている名前が考慮されます。送信先に最も近い Active Directory サイトの名前が英数字順で最下位になるルーティング パスが使用されます。評価されたすべてのルーティング パスで送信先に最も近いサイトが同じであった場合、さらに前のサイトの名前が考慮されます。

Exchange 2010 では、各メッセージ受信者が常に 1 つの Active Directory サイトだけに関連付けられるので、ソース Active Directory サイトから宛先 Active Directory サイトへの最小コストのルーティングは 1 つしか存在しません。Exchange 2013 では、配信グループが複数の Active Directory サイトにまたがる場合があり、そのような複数の Active Directory サイトへの最小コストのルーティング パスが複数存在することもあります。Exchange 2013 は宛先配信グループ内の 1 つの Active Directory サイトを *プライマリ サイト*として指定します。プライマリ サイトは、前に述べたルーティング ロジックを基準にした最も近い Active Directory サイトです。Exchange 2013 では、配信グループ間でメッセージを正常にルーティングできるよう、次の事項が考慮されます。

  - **最小コストのルーティング パスに沿った 1 つまたは複数のハブ サイトの存在**   プライマリ サイトへの最小コストのルーティング パスにハブ サイトが含まれている場合、ハブ サイトを通してメッセージをルーティングする必要があります。最小コストのルーティング パスに沿って最も近いハブ サイトは、**AD site** タイプの新しい配信グループとして選択され、ハブ サイト内のすべてのトランスポート サーバーが含まれます。メッセージがハブ サイトを通過した後、最小コストのルーティング パスに沿ってメッセージのルーティングが続行されます。プライマリ サイトがハブ サイトである場合でも、引き続きハブ サイトと見なされます。それは次の理由からです。
    
      - 宛先の配信グループが複数の Active Directory サイトにまたがる場合、ソース サーバーはハブ サイト内のサーバーにのみ接続しようとします。
    
      - ハブ サイト内のサーバーのうち実際にターゲット配信グループに属するサーバーが、優先的に使用されます。
    
    以前のバージョンの Exchange と同様、プライマリ サイトへの最小コストのルーティング パス上にないハブ サイトは無視されます。

  - **宛先ルーティング グループで選択されるターゲット Exchange サーバー**   宛先の配信グループが複数の Active Directory サイトにまたがる場合、配信グループ内の特定のサーバーへのルーティング パスのコストが複数存在する可能性があります。最も近い Active Directory サイト内にあるサーバーは、最小コストのルーティング パスに基づいて配信グループに対するターゲット サーバーとして選択されます。それらのサーバーがある Active Directory サイトは、プライマリ サイトとして選択されます。

  - **フォールバック オプション (送信先ルーティング グループ内のすべてのサーバーへの接続試行が失敗した場合)**   宛先の配信グループが複数の Active Directory サイトにまたがる場合、最初のフォールバック オプションは、他の Active Directory サイト内の宛先配信グループでターゲット サーバーとして選択されていない他のすべてのサーバーです。サーバーの選択は、他の Active Directory サイトへのルーティング パスのコストに基づいて行われます。ローカル Active Directory サイト内に宛先の配信グループのサーバーがある場合、他のフォールバック オプションはありません。メッセージは既にターゲットのルーティング先に最も近い位置にあります。リモート Active Directory サイト内に宛先配信グループのサーバーがある場合、オプションはプライマリ サイト内のすべての他のサーバーへの接続を試行することです。接続の試行が失敗すると、プライマリ サイトへの最小コストのルーティング パス内のバックオフ パスが使用されます。Exchange 2013 は、接続が確立されるまで最小コストのルーティング パス上で 1 ホップずつバックオフして、できるだけ送信先の近くにメッセージを配信しようと試みます。

ページのトップへ

## Active Directory サイト間でのメッセージのルーティング

Exchange 2013 における Active Directory サイト間でのメッセージのルーティング方法は、Exchange 2010 と実質的に同じです。詳細については、「[Active Directory サイト間でメールをルーティングする](route-mail-between-active-directory-sites-exchange-2013-help.md)」を参照してください。

ページのトップへ

## クライアント アクセス サーバー上のフロントエンド トランスポート サービスでのルーティング

これは、Exchange 2013 組織に対して、すべての受信および (オプションとして) 送信の外部 SMTP トラフィックのためのステートレス プロキシとして機能します。送信メッセージの場合、トランスポート サービスは送信コネクタを使用して、クライアント アクセス サーバー上のフロントエンド トランスポート サービスと通信します。具体的には、適用可能な送信コネクタ上の *FrontEndProxyEnabled* パラメーターが `$true` に設定されているか、Exchange 管理センター (EAC) 内の送信コネクタ プロパティで **\[クライアント アクセス サーバー経由のプロキシ\]** オプションが選択されている場合に、送信メッセージがフロントエンド トランスポート サービス経由でプロキシ処理されます。ローカル Active Directory サイト内にクライアント アクセス サーバーがあれば選択されます。フロントエンド トランスポート サービスには送信コネクタがないことに注意してください。

受信メッセージの場合、フロントエンド トランスポート サービスは、メールボックス サーバー上の単一の正常なトランスポート サービスを直ちに見つけて、受信者の数または種類に関係なくメッセージ転送を受信する必要があります。それに失敗した場合、外部送信者は、電子メール サービスを利用できないと判断します。フロントエンド トランスポート サービスは、トランスポート サービスと同様に、Active Directory からの情報に基づいてルーティング テーブルを読み込み、配信グループを使用してメッセージのルーティング方法を決定します。ただし、フロントエンド トランスポート サービスが使用するルーティング テーブルには、次のような固有の特性があります。

  - メールボックス サーバーおよびクライアント アクセス サーバーが同じ物理サーバー上にインストールされている場合でも、フロントエンド トランスポート サービスは、配信グループのメンバーであるとは見なされません。この結果、フロントエンド トランスポート サービスの通信先はトランスポート サービスだけに限定されます。

  - ルーティング テーブルには、送信コネクタのルートは一切含まれません。

  - 迅速にフェールオーバーできるように、ルーティング テーブルには、ローカル Active Directory サイト内のメールボックス サーバーの特別なリストが含まれます。

フロントエンド トランスポート サービスでのルーティングによって、メッセージ受信者がメールボックス データベースに解決されます。フロントエンド トランスポート サービスによって使用されるメールボックス サーバーのリストは、メッセージ受信者のメールボックス データベースに基づきます。いずれの受信者もメールボックスを持たない可能性もあります (たとえば、受信者が配布グループまたはメール ユーザーである場合など)。メールボックス データベースごとに、フロントエンド トランスポート サービスは配信グループおよび関連するルーティング情報を参照します。フロントエンド トランスポート サービスによって使用される配信グループには、次のものがあります。

  - ルーティング可能な DAG

  - メールボックス配信グループ

  - AD サイト

受信者の数および種類に応じて、フロントエンド トランスポート サービスは、次のいずれかのアクションを実行します。

  - メールボックス受信者が 1 人のメッセージについては、ターゲット配信グループ内のメールボックス サーバーを選択し、Active Directory サイトの近接度に基づいてメールボックス サーバーを優先します。メッセージを受信者にルーティングする場合に、ハブ サイトを経由する必要があることもあります。

  - メールボックス受信者が複数のメッセージについては、最初の 20 人の受信者を使用し、Active Directory サイトの近接度に基づいて最も近い配信グループ内のメールボックス サーバーを選択します。メッセージの分岐はフロントエンド トランスポート内では発生しません。このため、最終的に選択されるメールボックス サーバーは、メッセージ内の受信者数に関係なく 1 台だけです。

  - メッセージに対するメールボックス受信者が存在しない場合は、ローカル Active Directory サイト内のランダム メールボックス サーバーを選択します。

ページのトップへ

## メールボックス サーバー上のメールボックス トランスポート サービスでのルーティング

これは 2 つの別個のサービスで構成されています。メールボックス トランスポート送信サービスとメールボックス トランスポート配信サービスの 2 つのサービスで構成されています。受信メッセージに関しては、メールボックス トランスポート配信サービスがトランスポート サービスから SMTP メッセージを受信し、RPC を使用してローカル メールボックス データベースに接続し、メッセージを配信します。送信メッセージに関しては、メールボックス トランスポート発信サービスが RPC を使用してローカル メールボックス データベースに接続し、メッセージを取得して、SMTP を介してトランスポート サービスに送信します。メールボックス トランスポート サービスはステートレスであり、メッセージをローカルにキュー登録しません。

メールボックス トランスポート サービスは、トランスポート サービスと同様に、Active Directory からの情報に基づいてルーティング テーブルを読み込み、配信グループを使用してメッセージのルーティング方法を決定します。ただし、メールボックス トランスポート サービスのルーティングには、他と異なる点があります。

  - トランスポート サービスとメールボックス トランスポート サービスは、同じ Exchange 2013 メールボックス サーバーに存在するので、メールボックス トランスポート サービスは常に、そのメールボックス サーバーと同じ配信グループに属します。この配信グループは、*ローカル配信グループ*と呼ばれています。

  - メールボックス トランスポート発信サービスは、それ自身のローカル配信グループ内のローカル メールボックス サーバーまたは他のメールボックス サーバー上にあるトランスポート サービスには、自動的にメッセージを送信しません。メールボックス トランスポート発信サービスは、トランスポート サービスと同じルーティング トポロジー情報へのアクセスを許可されているため、配信グループ外のメールボックス サーバー上のトランスポート サービスにメッセージを送信できます。ローカルの配信グループ内のメールボックス サーバーは、フォールバック オプションとして使用され、メールボックスではない受信者への配信に使用されます。

  - メールボックス トランスポート サービスは Exchange 2013 メールボックス サーバー上のトランスポート サービスとだけ通信します。

  - メールボックス トランスポート サービスは、ローカル Exchange 2013 メールボックス サーバー上のメールボックス データベースとだけ通信します。メールボックス トランスポート サービスは、他のメールボックス サーバー上にあるメールボックス データベースとは通信しません。

ユーザーがメールボックスからメッセージを送信すると、メールボックス トランスポート発信サービスによってメッセージ受信者がメールボックス データベースに解決されます。メールボックス トランスポート発信サービスによって使用されるメールボックス サーバーのリストは、メッセージ受信者のメールボックス データベースに基づきます。いずれの受信者もメールボックスを持たない可能性もあります (たとえば、受信者が配布グループまたはメール ユーザーである場合など)。メールボックス データベースごとに、メールボックス トランスポート発信サービスは、配信グループおよび関連するルーティング情報を参照します。メールボックス トランスポート発信サービスによって使用される配信グループには、次のものがあります。

  - ルーティング可能な DAG

  - メールボックス配信グループ

  - AD サイト

受信者の数および種類に応じて、メールボックス トランスポート発信サービスは、次のいずれかのアクションを実行します。

  - メールボックス受信者が 1 人のメッセージについては、ターゲット配信グループ内のメールボックス サーバーを選択し、Active Directory サイトの近接度に基づいてメールボックス サーバーを優先します。メッセージを受信者にルーティングする場合に、ハブ サイトを経由する必要があることもあります。

  - メールボックス受信者が複数のメッセージについては、最初の 20 人の受信者を使用し、Active Directory サイトの近接度に基づいて最も近い配信グループ内のメールボックス サーバーを選択します。

  - メッセージに対するメールボックス受信者が存在しない場合は、ローカル配布グループ内のメールボックス サーバーを選択します。

メールボックス トランスポート配信サービスは、トランスポート サービスからメッセージを受信する際、ローカル メールボックス データベースへのメッセージ配信を受諾または拒否します。メールボックス トランスポート配信サービスは、受信者がローカル メールボックス データベースのアクティブ コピー内に存在する場合、メッセージを配信できます。しかし、受信者がローカル メールボックス データベースのアクティブ コピー内に存在しない場合、メールボックス トランスポート配信サービスはメッセージを配信できず、トランスポート サービスに配信不能応答を送る必要があります。たとえば、最近、メールボックス データベースのアクティブ コピーが別のサーバーに移動された場合は、トランスポート サービスが、アクティブではないメールボックス データベースのコピーを現在保持しているメールボックスに、メッセージを誤って転送する可能性があります。メールボックス トランスポート配信サービスがトランスポート サービスに返す配信不能応答には、次のものがあります。

  - 配信の再試行

  - NDR の生成

  - メッセージの再ルーティング

ページのトップへ

## エッジ トランスポート サーバー上のトランスポート サービスでのルーティング

境界ネットワークにエッジ トランスポート サーバーをインストールした場合、エッジ トランスポート サーバー上のトランスポート サービスは、インターネットに接続するすべてのメール フローに対して SMTP リレーおよびスマート ホスト サービスを提供します。インターネットとの間で送受信されるメッセージは、エッジ トランスポート サーバー上でローカル キューに格納されます。キューは、外部ドメインまたは送信コネクタに対応します。詳細については、「[キュー](queues-exchange-2013-help.md)」トピックの「NextHopSolutionKey」セクションを参照してください。

通常、エッジ トランスポート サーバーを境界ネットワークにインストールする場合は、エッジ トランスポート サーバーを Active Directory サイトにサブスクライブします。Active Directory サイトには、エッジ トランスポート サーバーとの間でメッセージを中継するメールボックス サーバーが含まれます。エッジ サブスクリプション プロセスは、エッジ トランスポート サーバーに関する Active Directory サイトのメンバーシップ関係を作成します。このサイトの関係によって、Active Directory サイト内のメールボックス サーバーは、明示的な送信コネクタを構成しなくても、インターネットに向けて配信するメッセージをエッジ トランスポート サーバーに中継できます。

複数サイト構成では、内部受信者から外部受信者に送られる送信メールは、サブスクライブされた Active Directory サイトに最初にルーティングされます。ターゲットとなる Active Directory サイトは、配信グループです。ルーティングの宛先は、サブスクライブされた Active Directory サイト内の任意のメールボックス サーバー上にあるトランスポート サービス内の組織内送信コネクタです。*組織内送信コネクタ*は、すべてのメールボックス サーバー上のトランスポート サービス内にある特殊な送信コネクタです。この送信コネクタは、暗黙的に作成され、不可視で、管理を必要とせず、Exchange サーバー間でメッセージを中継するために使用されます。

外部受信者への送信メールは、メールボックス サーバーからエッジ トランスポート サーバーにルーティングされます。サブスクライブされたエッジ トランスポート サーバーへのメールのルーティングに、クライアント アクセス サーバーは関与しません。メールは、メールボックス サーバー上のトランスポート サービスにある組織内送信コネクタから、エッジ トランスポート サーバー上のトランスポート サービスにある受信コネクタに送られます。サブスクライブされたエッジ トランスポート サーバーでは、サブスクライブされた Active Directory サイト内の内部メールボックス サーバーからの接続と、インターネットからの匿名での接続をリッスンするように既定の受信コネクタが構成されます。メッセージは、エッジ トランスポート サーバー上のトランスポート サービスによって分類された後、ローカル キューに格納され、エッジ サブスクリプションの際に作成された専用送信コネクタを使用してインターネット向けに配信されます。

外部受信者からの受信メールは、既定の受信コネクタを経由してエッジ トランスポートに到着し、そのメッセージは分類され、配信のためにキューに格納されます。メッセージは、Exchange 組織にメールを送信するためにエッジ サブスクリプションにより作成された専用送信コネクタを経由して中継されます。メッセージが次にどこへ移動するかは、内部 Exchange サーバーがどのように構成されているかに応じて異なります。

  - **メールボックス サーバーとクライアント アクセス サーバーが同一のコンピューターにインストールされている場合**   この構成の場合、クライアント アクセス サーバーが受信メール フローのために使用されます。メールは、エッジ トランスポート サーバー上のトランスポート サービス内の送信コネクタから、クライアント アクセス サーバー上のフロントエンド トランスポート サービス内の既定の受信コネクタに送られた後、メールボックス サーバー上のトランスポート サービス内の既定の受信コネクタに送られます。

  - **メールボックス サーバーとクライアント アクセス サーバーが異なるコンピューターにインストールされている場合**   この構成の場合、クライアント アクセス サーバーは受信メール フローでは使用されません。メールは、エッジ トランスポート サーバー上のトランスポート サービス内の送信コネクタから、メールボックス サーバー上のトランスポート サービス内の既定の受信コネクタに送られます。

境界ネットワークに Exchange 2007 または Exchange 2010 のエッジ トランスポート サーバーがインストールされている場合は、受信メールおよび送信メールは、常にエッジ トランスポート サーバーおよびメールボックス サーバーの間で直接やり取りされます。クライアント アクセス サーバーは使用されません。

ページのトップへ

