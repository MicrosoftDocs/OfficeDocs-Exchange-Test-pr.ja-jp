---
title: '切り替えとフェールオーバー: Exchange 2013 Help'
TOCTitle: 切り替えとフェールオーバー
ms:assetid: 75388645-cae1-402e-bf02-c4949d3e2c31
ms:mtpsurl: https://technet.microsoft.com/ja-jp/library/Dd298067(v=EXCHG.150)
ms:contentKeyID: 62523711
ms.date: 04/24/2018
mtps_version: v=EXCHG.150
ms.translationtype: HT
---

# 切り替えとフェールオーバー

 

_**適用先:** Exchange Server 2013 SP1_

_**トピックの最終更新日:** 2015-12-02_

切り替えとフェールオーバーは、Microsoft Exchange Server 2013 における 2 つの停止形式です。

  - *切り替え*は、コマンドレットによってまたは Exchange 2013 の可用性管理システムによって明示的に開始されたデータベースまたはサーバーのスケジュールされた停止です。切り替えは通常、メンテナンス操作を実行する準備のために行われます。切り替えでは、アクティブなメールボックス データベース コピーをデータベース可用性グループ (DAG) 内の別のサーバーに移行する必要があります。切り替えのときに正常なターゲットが見つからない場合、管理者はエラーを受け取り、メールボックス データベースは稼働状態またはマウント状態を維持します。

  - *フェールオーバー*は、サービス、データ、またはサービスとデータの両方が使用できなくなる予期せぬ停止を表します。フェールオーバーでは、システムが、パッシブ メールボックス データベース コピーをアクティブ化し、それをアクティブなメールボックス データベース コピーにすることで、障害から自動的に回復する必要があります。フェールオーバーのときに正常なターゲットが見つからない場合、メールボックス データベースはマウント解除されます。

Exchange 2013 は、特に切り替えとフェールオーバーの両方を処理するように設計されています。

高可用性とサイト復元に関連する管理タスクについては、「[高可用性とサイト復元の管理](managing-high-availability-and-site-resilience-exchange-2013-help.md)」を参照してください。

## 切り替え

Exchange 2013 の切り替えには次の 3 種類があります。

  - データベース切り替え

  - サーバー切り替え

  - データセンター切り替え

## データベース切り替え

*データベース切り替え*は、個別のアクティブなデータベースを別のデータベース コピー (パッシブ コピー) に切り替えるプロセスであり、そのデータベース コピーが新しいアクティブなデータベース コピーになります。データベース切り替えは、データセンター内部とデータセンター間の両方で実行可能です。データベース切り替えは、Exchange 管理センター (EAC) またはシェルを使用して行えます。使用するインターフェイスにかかわらず、切り替えプロセスは以下のように行われます。

1.  管理者は、データベース切り替えを開始して、現在のアクティブなメールボックス データベース コピーを別のサーバーに移行します。

2.  タスクに使用するクライアントは、DAG メンバー上で Microsoft Exchange Replication サービスへの RPC 呼び出しを作成します。

3.  DAG メンバーがプライマリ アクティブ マネージャー (PAM) 役割を持たない場合、DAG メンバーは PAM の役割が割り当てられたサーバーに、タスクを照会します。

4.  タスクは、PAM の役割が割り当てられたサーバー上で Microsoft Exchange Replication サービスへの RPC 呼び出しを作成します。

5.  PAM は、DAG 用にクラスター データベースに格納されているデータベースの場所情報を読み取り更新します。

6.  PAM は、新しいアクティブなメールボックス データベース コピーとして DAG メンバー上で Microsoft Exchange Replication サービスに接続します。

7.  ターゲット サーバー上の Microsoft Exchange Replication サービスは、その他すべての DAG メンバーについて Microsoft Exchange Replication サービスに照会して、データベース コピー用に最適なログ ソースを決定します。

8.  データベースは現在のサーバーからマウント解除され、ターゲット サーバー上の Microsoft Exchange Replication サービスが残りのログをターゲット サーバーにコピーします。

9.  ターゲット サーバー上の Microsoft Exchange Replication サービスは、データベースのマウントを要求します。

10. ターゲット サーバー上の Microsoft Exchange Information Store サービスは、ログ ファイルを再生してデータベースをマウントします。

11. エラー コードがターゲット サーバー上の Microsoft Exchange Replication サービスに返されます。

12. PAM は、DAG 用のクラスター データベース内のデータベース コピー状態情報を更新します。

13. エラー コードがターゲット サーバー上の Microsoft Exchange Replication サービスから PAM 上の Microsoft Exchange Replication サービスに返されます。

14. タスクが呼び出された管理インターフェイスに対して、PAM 上の Microsoft Exchange Replication サービスからエラーが返されます。

15. 呼び出している管理インターフェイスに対して、リモート PowerShell から操作結果が返されます。

データベース切り替えを実行する方法の詳細手順については、「[メールボックス データベース コピーをアクティブにする](activate-a-mailbox-database-copy-exchange-2013-help.md)」を参照してください。

## サーバー切り替え

サーバー切り替えは、DAG メンバー上のすべてのアクティブなデータベースを 1 つまたは複数のその他の DAG メンバーに対してアクティブ化するプロセスです。データベース切り替えと同様に、サーバー切り替えはデータセンター内部とデータセンター間の両方で実行可能で、EAC とシェルの両方を使用して開始することができます。使用するインターフェイスにかかわらず、サーバー切り替えプロセスは以下のように行われます。

1.  管理者は、サーバー切り替えを開始して、現在のすべてのアクティブなメールボックス データベース コピーを 1 つまたは複数のその他のサーバーに移行します。

2.  タスクは、現在のサーバー上のアクティブな各データベースに対して、このトピックの前に述べたデータベース切り替え手順 (手順 2 ～ 4) を実行します。

3.  PAM は、DAG 用にクラスター データベースに格納されているデータベースの場所情報を読み取り更新します。

4.  PAM は、アクティブ化されるパッシブ コピーを持つ各 DAG メンバー上の Microsoft Exchange Replication サービスに接続します。

5.  ターゲット サーバー上の Microsoft Exchange Replication サービスは、その他すべての DAG メンバーについて Microsoft Exchange Replication サービスに照会して、データベース コピー用に最適なログ ソースを決定します。

6.  データベースは現在のサーバーからマウント解除され、各ターゲット サーバー上の Microsoft Exchange Replication サービスが残りのログをコピーします。

7.  各ターゲット サーバー上の Microsoft Exchange Replication サービスは、データベースのマウントを要求します。

8.  各ターゲット サーバー上の Microsoft Exchange Information Store サービスは、ログ ファイルを再生してデータベースをマウントします。

9.  エラー コードがターゲット サーバー上の Microsoft Exchange Replication サービスに返されます。

10. PAM は、DAG 用のクラスター データベース内のデータベース コピー状態情報を更新します。

11. エラー コードがターゲット サーバー上の Microsoft Exchange Replication サービスから PAM 上の Microsoft Exchange Replication サービスに返されます。

12. タスクが呼び出された管理インターフェイスに対して、PAM 上の Microsoft Exchange Replication サービスからエラーが返されます。

13. 呼び出している管理インターフェイスに対して、リモート PowerShell から操作結果が返されます。

サーバー切り替えを実行する方法の詳細な手順については、「[サーバー切り替えを実行する](perform-a-server-switchover-exchange-2013-help.md)」を参照してください。

## データセンター切り替え

サイトの復元構成では、サイト レベルのエラーに対する自動回復が DAG 内で発生する場合があります。これにより、メッセージング システムは機能した状態のままになります。この設定では、DAG メンバーを 2 か所に展開し、DAG のミラーリング監視サーバーを残りの 1 か所に展開する必要があるため、少なくとも 3 つの場所が必要です。

3 つの場所が存在しない場合、または存在するものの、データセンター レベルの回復アクションを制御したい場合は、サイト レベルのエラーが発生した場合に備えて手動回復用に DAG を設定できます。その場合、*データセンター切り替え* と呼ばれるプロセスを実行します。多くの障害復旧シナリオと同様に、データセンター切り替えを事前に計画および準備すると、復旧プロセスを簡略化して停止期間を短縮できます。

Exchange 2013 では、サーバーの役割の統合を含め、多くのアーキテクチャに変更が加えられているため、Exchange 2013 でのデータセンター切り替え実行は、Exchange 2010 の場合よりも大幅に簡単になっています。データセンター切り替えを実行する手順の詳細については、「[データセンターの切り替え](datacenter-switchovers-exchange-2013-help.md)」を参照してください。

## フェールオーバー

フェールオーバーは、データベース レベル、サーバー レベル、データセンター レベルのいずれかで行われる自動アクティブ化プロセスです。フェールオーバーは、個別データベースに影響を与える障害 (例: 単独ストレージ障害)、サーバー全体に影響を与える障害 (例: マザーボード障害または電源障害)、サイト全体に影響を与える障害 (例: サイトの全 DAG メンバーの障害) に対応して実行されます。

DAG およびメールボックス データベース コピーは、データと、データへのアクセスを提供するサービスの両方に完全な冗長性を提供し、迅速な回復を可能にします。次の表では、さまざまな障害の際に予期される復旧処理について示します。管理者が復旧を開始する必要がある障害もあれば、システムによって自動的に処理される障害もあります。


<table style="width:100%;">
<colgroup>
<col style="width: 14%" />
<col style="width: 14%" />
<col style="width: 14%" />
<col style="width: 14%" />
<col style="width: 14%" />
<col style="width: 14%" />
<col style="width: 14%" />
</colgroup>
<thead>
<tr class="header">
<th>説明</th>
<th>自動アクティブ化</th>
<th>自動修復処理</th>
<th>修復中の状態:アクティブ</th>
<th>修復中の状態:パッシブ</th>
<th>修復操作</th>
<th>コメント</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p>拡張ストレージ エンジン (ESE) ソフト データベース障害:データベースを格納するドライブが読み取り時にエラーを返しています (例: -1018 エラー)</p></td>
<td><p>短期間の停止の可能性。</p>
<p>自動フェールオーバーの可能性。</p></td>
<td><p>不良ページの自動修正。</p></td>
<td><p>手動切り替え、自動フェールオーバー、またはオンライン修復。</p></td>
<td><p>失敗</p></td>
<td><p>RAID の再構築、データベースおよびデータベース コピーの修復、復元および回復実行後のページ修正、またはコピーからのページ修正。</p></td>
<td><p>その他のソフト データベースの障害コードも存在する可能性があります。</p>
<p>NTFS ファイル システム ブロック障害は含まれません。</p>
<p>フェールオーバーまたは切り替えを実行すると、ホスト サーバーが更新されます。</p></td>
</tr>
<tr class="even">
<td><p>ESE &quot;<em>semi-soft&quot;</em> データベース障害:データベースを格納するドライブが読み取り時にエラーを返しています。</p></td>
<td><p>自動フェールオーバー中の短期間の停止。</p></td>
<td><p>ドライブを交換した場合は、その後に自動ボリューム/ディスク再構築。</p></td>
<td><p>回復できない場合はマウント解除されます。</p></td>
<td><p>失敗</p></td>
<td><p>RAID の再構築で問題が解決する場合があります。</p>
<p>交換を行った場合は、その後にコピーと修復、復元と回復実行、またはボリューム/ディスク再構築。</p></td>
<td><p>ESE semi-soft 書き込みエラーは、書き込みが正常に実行されたことを意味します。</p>
<p>NTFS ブロック障害が含まれていません。</p></td>
</tr>
<tr class="odd">
<td><p>ESE &quot;semi-soft&quot; ログ障害:ログ データを格納するドライブが読み取りまたは書き込み時に回復不可能なエラーを返しています。</p></td>
<td><p>自動フェールオーバー中の短期間の停止。</p></td>
<td><p>ドライブを交換した場合は、その後に自動ボリューム/ディスク再構築。</p></td>
<td><p>回復できない場合はマウント解除されます。</p></td>
<td><p>失敗</p></td>
<td><p>RAID の再構築で問題が解決する場合があります。</p>
<p>交換を実施した場合は、その後にコピーと修復、復元と回復実行、またはボリューム/ディスク再構築。</p></td>
<td><p>ESE semi-soft 読み取り/書き込みエラーは、読み取り/書き込みが正常に実行されたことを意味します。</p>
<p>データベースにエラーが発生すると、ログ データ修復処理が開始される前に自動化された回復が行われます。</p></td>
</tr>
<tr class="even">
<td><p>ESE ソフトウェア エラーまたはリソースの枯渇:ESE がインスタンスを終了させるエラー (例: イベント ID 1022、チェックポイントが深すぎる)。</p></td>
<td><p>自動フェールオーバー中の短期間の停止。</p></td>
<td><p>なし。</p></td>
<td><p>回復できない場合はマウント解除されます。</p></td>
<td><p>失敗</p></td>
<td><p>基になるリソースの問題を修正します。</p></td>
<td><p>このエラーは、その他のケースの表面化したエラーである可能性があります。</p></td>
</tr>
<tr class="odd">
<td><p>NTFS ブロック障害:データベースまたはログを格納するドライブで、NTFS 制御構造への読み取りまたは書き込みエラーが発生します。</p></td>
<td><p>自動フェールオーバー中の短期間の停止。</p></td>
<td><p>ドライブを交換した場合は、その後にボリュームの完全な再構築。</p></td>
<td><p>回復できない場合はマウント解除されます。</p></td>
<td><p>失敗</p></td>
<td><p>RAID の再構築で問題が解決する場合があります。NTFS ユーティリティによって、NTFS の問題が解決する場合があります。Exchange 回復が必要になる可能性があります。</p></td>
<td><p>これは、RAID が使用中でないときに発生する可能性が高くなります。これによってアクティブなログ ボリュームに影響がある場合、最近のログ ファイルのいくつかが失われます。</p>
<p>NTFS またはその基となるソフトウェアやハードウェア スタックによって自動的に修正されるエラーは含まれません。</p></td>
</tr>
<tr class="even">
<td><p>データベースまたはログ ドライブ障害:データベースまたはログを格納するドライブが完全に失敗して、アクセスできません。</p></td>
<td><p>自動フェールオーバー中の短期間の停止。</p></td>
<td><p>ドライブの再フォーマットまたは交換とその後の完全なボリューム再構築。</p></td>
<td><p>回復できない場合はマウント解除されます。</p></td>
<td><p>失敗</p></td>
<td><p>ドライブの交換後、可能であれば RAID 再構築。</p>
<p>ドライブの交換後、完全なボリューム再構築。</p>
<p>完全なボリューム再構築。</p></td>
<td><p>該当なし。</p></td>
</tr>
<tr class="odd">
<td><p>データベースまたはログ ボリューム障害:ボリュームが NTFS または下位レベルのボリュームの問題によって失敗します。</p></td>
<td><p>自動フェールオーバー中の短期間の停止。</p></td>
<td><p>ドライブの再フォーマットまたは交換。</p></td>
<td><p>回復できない場合はマウント解除されます。</p></td>
<td><p>失敗</p></td>
<td><p>ドライブの交換後、可能であれば RAID 再構築。</p>
<p>ドライブの交換後、完全なボリューム再構築。</p>
<p>完全なボリューム再構築。</p></td>
<td><p>該当なし。</p></td>
</tr>
<tr class="even">
<td><p>データベースまたはログ ボリュームの空き容量の不足:データベースまたはログ ファイルの NTFS ファイル システムが空き容量不足です。</p></td>
<td><p>その他のコピーが同じような状態でない場合の自動フェールオーバー。</p></td>
<td><p>なし。</p></td>
<td><p>マウント解除。</p></td>
<td><p>失敗</p></td>
<td><p>完全または増分バックアップの実行、手動によるログ削除、時間待機、データベース コピー再開、または失敗したデータベース コピーの修復。</p></td>
<td><p>該当なし。</p></td>
</tr>
<tr class="odd">
<td><p>管理者は、間違ったデータベースをマウント解除します。</p></td>
<td><p>管理者が自動フェールオーバーをブロックしないと、停止が短期間になります。</p>
<p>自動フェールオーバーができないようにすると、データベースがマウントされるまで停止します。</p></td>
<td><p>なし。</p></td>
<td><p>マウント解除。</p></td>
<td><p>該当なし</p></td>
<td><p>管理者がエラーを修正します。</p></td>
<td><p>該当なし。</p></td>
</tr>
<tr class="even">
<td><p>管理者が間違ったデータベース コピーを中断します。</p></td>
<td><p>構成と影響を受けるコピーによっては、自動回復ができない場合があります。</p></td>
<td><p>なし。</p></td>
<td><p>該当なし。</p></td>
<td><p>中断</p></td>
<td><p>管理者がエラーを修正します。</p></td>
<td><p>該当なし。</p></td>
</tr>
<tr class="odd">
<td><p>管理者がストレージ、NTFS、またはボリュームの保守用にデータベースをマウント解除します。</p></td>
<td><p>管理者が自動フェールオーバーをブロックしないと、停止が短期間になります。</p>
<p>自動フェールオーバーをブロックすると、管理者がタスクを終了するまで停止します。</p></td>
<td><p>なし。</p></td>
<td><p>マウント解除。</p></td>
<td><p>該当なし</p></td>
<td><p>管理者がタスクを完了します。</p></td>
<td><p>該当なし。</p></td>
</tr>
<tr class="even">
<td><p>管理者がストレージ、NTFS、またはボリュームの保守用にデータベース コピーを中断します。</p></td>
<td><p>構成と影響を受けるコピーによっては、自動回復ができない場合があります。</p></td>
<td><p>なし。</p></td>
<td><p>該当なし。</p></td>
<td><p>中断</p></td>
<td><p>管理者が操作を完了します。</p></td>
<td><p>該当なし。</p></td>
</tr>
<tr class="odd">
<td><p>管理者がオフライン データベース保守用にデータベースをマウント解除します。</p></td>
<td><p>修復までの停止。</p></td>
<td><p>なし。</p></td>
<td><p>マウント解除。</p></td>
<td><p>中断</p></td>
<td><p>管理者が操作を完了します。</p></td>
<td><p>のアクティブおよびパッシブのデータベース コピーに相違があります。</p>
<p>管理者は、コピーを中断する必要があります。</p></td>
</tr>
<tr class="even">
<td><p>ストレージ エリア ネットワーク (SAN)、ディスク、またはストレージ コントローラーの障害。</p></td>
<td><p>自動フェールオーバー中の短期間の停止。</p></td>
<td><p>なし。</p></td>
<td><p>マウント解除。</p></td>
<td><p>任意</p></td>
<td><p>ハードウェア修復。</p></td>
<td><p>パッシブ データベース コピーは、システムに障害が発生した時点で存在した状態になります。</p></td>
</tr>
<tr class="odd">
<td><p>サーバー ハードウェア保守。</p></td>
<td><p>自動フェールオーバー中の短期間の停止 (管理者によってブロックされていない場合)。</p></td>
<td><p>なし。</p></td>
<td><p>マウント解除。</p></td>
<td><p>任意</p></td>
<td><p>操作の完了。</p></td>
<td><p>パッシブ データベース コピーは、システムがシャットダウンした時点で存在した状態になります。</p></td>
</tr>
<tr class="even">
<td><p>サーバー ソフトウェア保守。</p></td>
<td><p>自動フェールオーバー中の短期間の停止 (管理者によってブロックされていない場合)。</p></td>
<td><p>なし。</p></td>
<td><p>マウント解除。</p></td>
<td><p>任意</p></td>
<td><p>操作の完了。</p></td>
<td><p>パッシブ データベース コピーは、システムがシャットダウンした時点で存在した状態になります。</p></td>
</tr>
<tr class="odd">
<td><p>Microsoft Exchange Information Store サービスが管理者によって停止または一時停止されます。</p></td>
<td><p>自動フェールオーバー中の短期間の停止。</p></td>
<td><p>なし。</p></td>
<td><p>マウント解除。</p></td>
<td><p>任意</p></td>
<td><p>Microsoft Exchange Information Store サービスを再起動します。</p></td>
<td><p>該当なし。</p></td>
</tr>
<tr class="even">
<td><p>Microsoft Exchange Information Store サービスが失敗し、オペレーティング システムがまだ実行中です。</p></td>
<td><p>自動フェールオーバー中の短期間の停止。</p></td>
<td><p>サービス コントロール マネージャーが Microsoft Exchange Information Store サービスを再起動します。</p></td>
<td><p>マウント解除。</p></td>
<td><p>任意</p></td>
<td><p>手動または自動で Microsoft Exchange Information Store サービスを再起動します。</p></td>
<td><p>パッシブ データベース コピーは、Microsoft Exchange Information Store サービスに障害が発生した時点で存在した状態になります。</p></td>
</tr>
<tr class="odd">
<td><p>部分的な Microsoft Exchange Information Store サービス障害。Exchange ストアの一部が機能を停止していますが、完全に失敗しているとは確認されていません。</p></td>
<td><p>自動フェールオーバー中に短期間の停止の可能性。</p></td>
<td><p>なし。</p></td>
<td><p>マウントされ、部分的に機能します。</p></td>
<td><p>任意だが、部分的にのみ機能する場合があります。</p></td>
<td><p>サーバー、オペレーティング システム、または Microsoft Exchange Information Store サービスを再起動します。</p></td>
<td><p>該当なし。</p></td>
</tr>
<tr class="even">
<td><p>サーバー障害:次のいずれかの理由によりサーバーに障害が発生しました。</p>
<ul>
<li><p>完全な電源障害</p></li>
<li><p>プロセッサ チップ、マザーボード、またはバックプレーンの修復不可能な障害</p></li>
<li><p>オペレーティング システム停止エラー</p></li>
<li><p>オペレーティング システム応答停止</p></li>
<li><p>完全な通信障害</p></li>
</ul></td>
<td><p>自動フェールオーバー中の短期間の停止。</p></td>
<td><p>コンピューターを再起動します。</p></td>
<td><p>マウント解除。</p></td>
<td><p>任意</p></td>
<td><p>電源の復旧、オペレーティング システム設定の変更、ハードウェア設定の変更、ハードウェアの交換、オペレーティング システムの再起動、オペレーティング システムの保守、ハードウェアの保守、または通信の問題の修復。</p></td>
<td><p>該当なし。</p></td>
</tr>
<tr class="odd">
<td><p>DAG にクォーラム障害が発生しました。</p></td>
<td><p>修復までの停止。</p></td>
<td><p>なし。</p></td>
<td><p>マウント解除。</p></td>
<td><p>任意</p></td>
<td><p>失敗したクォーラムの修復、新規クォーラムの割り当て、またはクォーラム失敗を引き起こしているネットワークの復旧。</p></td>
<td><p>パッシブ データベース コピーは、システムに障害が発生した時点で存在した状態になります。</p></td>
</tr>
<tr class="even">
<td><p>MAPI ネットワーク通信障害:サーバーは MAPI ネットワーク上で利用できなくなりました。</p></td>
<td><p>自動フェールオーバー中の短期間の停止。ロスレスでなくてはなりません。</p></td>
<td><p>なし。通信は引き続き試行されます。</p></td>
<td><p>マウント解除。</p></td>
<td><p>任意</p></td>
<td><p>ハードウェアまたはソフトウェアの問題を修正することによって、通信の問題を修正します。</p></td>
<td><p>該当なし。</p></td>
</tr>
<tr class="odd">
<td><p>レプリケーション ネットワーク通信障害:失敗したレプリケーション ネットワーク経由でサーバーがハートビート、ログ コピー、またはシードを受信できません。</p></td>
<td><p>負荷を他のネットワークに切り替えている間に、コピーまたはシード処理の短期間の停止の可能性。</p></td>
<td><p>なし。通信は引き続き試行されます。</p></td>
<td><p>なし。</p></td>
<td><p>任意</p></td>
<td><p>ハードウェアまたはソフトウェアの問題を修正することによって、通信の問題を修正します。</p></td>
<td><p>障害によって影響を受ける復元。</p></td>
</tr>
<tr class="even">
<td><p>複数のネットワーク通信障害:複数のネットワーク経由でサーバーがハートビート、ログ コピー、またはシードを受信できません。</p></td>
<td><p>自動フェールオーバー中の短期間の停止。ロスレスでなければなりません。</p></td>
<td><p>なし。通信は引き続き試行されます。</p></td>
<td><p>マウント解除。</p></td>
<td><p>任意</p></td>
<td><p>ハードウェアまたはソフトウェアの問題を修正することによって、通信の問題を修正します。</p></td>
<td><p>少なくとも 1 つのネットワークがまだ機能しています。</p></td>
</tr>
<tr class="odd">
<td><p>1 つまたは複数のネットワークの部分的な障害:ネットワークで高エラー率が発生します。</p></td>
<td><p>障害を検出できません。操作はありません。</p></td>
<td><p>なし。</p></td>
<td><p>マウントされていますが、パフォーマンスの問題の可能性があります。</p></td>
<td><p>任意</p></td>
<td><p>ハードウェアまたはソフトウェアの問題を修正することによって、通信の問題を修正します。</p></td>
<td><p>ネットワークで通常より高いエラー率が発生します。</p></td>
</tr>
<tr class="even">
<td><p>未検出のオペレーティング システムのハング:オペレーティング システムが応答を停止するが、監視またはクラスタリングでは検出されません。</p></td>
<td><p>なし。</p></td>
<td><p>なし。</p></td>
<td><p>任意。</p></td>
<td><p>任意</p></td>
<td><p>応答していないリソースを再起動または終了します。</p></td>
<td><p>ハングが検出されないので、操作が行われません。</p>
<p>一部の機能は動作可能です。</p></td>
</tr>
<tr class="odd">
<td><p>オペレーティング システム ドライブで障害が発生しました。</p></td>
<td><p>自動フェールオーバー中の短期間の停止。</p></td>
<td><p>なし。</p></td>
<td><p>マウント解除。</p></td>
<td><p>任意</p></td>
<td><p>ドライブの交換と、サーバーの再構築または RAID を使用したボリュームの再構築。</p></td>
<td><p>該当なし。</p></td>
</tr>
<tr class="even">
<td><p>オペレーティング システム ドライブの容量不足。</p></td>
<td><p>自動フェールオーバー中の短期間の停止。</p></td>
<td><p>なし。</p></td>
<td><p>マウント解除。</p></td>
<td><p>任意</p></td>
<td><p>手動でボリューム上の領域を解放します。</p></td>
<td><p>該当なし。</p></td>
</tr>
<tr class="odd">
<td><p>Exchange バイナリが含まれているドライブでボリュームまたはドライブの障害が発生しました。</p></td>
<td><p>自動フェールオーバー中の短期間の停止。</p></td>
<td><p>なし。</p></td>
<td><p>マウント解除。</p></td>
<td><p>任意</p></td>
<td><p>ドライブの交換と、アプリケーションの再インストールまたは RAID を使用したボリュームの再構築。</p></td>
<td><p>該当なし。</p></td>
</tr>
<tr class="even">
<td><p>Exchange バイナリが含まれているドライブの空き領域が不足しています。</p></td>
<td><p>自動フェールオーバー中の短期間の停止。</p></td>
<td><p>なし。</p></td>
<td><p>マウント解除。</p></td>
<td><p>任意</p></td>
<td><p>手動でボリューム上の領域を解放します。</p></td>
<td><p>該当なし。</p></td>
</tr>
<tr class="odd">
<td><p>無効な新規ログの検出:ログ シーケンスが既存のファイルによって中断されます。</p></td>
<td><p>自動フェールオーバー中の短期間の停止。その他のコピーには同じ問題がないものとします。</p></td>
<td><p>なし。</p></td>
<td><p>マウント解除。</p></td>
<td><p>失敗</p></td>
<td><p>ソース確認後に壊れたログを削除します。</p></td>
<td><p>壊れたログをレプリケートしないでください。</p></td>
</tr>
<tr class="even">
<td><p>継続レプリケーションで無効なログを検出しました:再生がコピーまたは再生中に不適切なログを検出しました。</p></td>
<td><p>該当なし。</p></td>
<td><p>ログを破棄します。</p></td>
<td><p>該当なし。</p></td>
<td><p>失敗</p></td>
<td><p>無効なログを破棄します。影響のあるログ ストリームを移動します。</p></td>
<td><p>該当なし。</p></td>
</tr>
</tbody>
</table>


## データベースのフェールオーバー

データベースのフェールオーバーは、アクティブ状態のデータベース コピーがアクティブ状態を続けることができなくなったときに実行されます。データベースのフェールオーバーでは、次の操作が行われます。

1.  データベース障害が Microsoft Exchange Information Store サービスによって検出されます。

2.  Microsoft Exchange Information Store サービスが障害イベントを crimson チャネル イベント ログに書き込みます。

3.  障害が発生したデータベースを含むサーバー上のアクティブ マネージャーが障害イベントを検出します。

4.  アクティブ マネージャーがデータベースのコピーを保有するその他のサーバーのデータベース コピー状態を要求します。

5.  その他のサーバーは、要求されたデータベース コピー状態を要求元のアクティブ マネージャーに返します。

6.  PAM は、最適なコピーの選択アルゴリズムを使用して DAG 内の別のサーバーに対するアクティブなデータベースの移行を開始します。

7.  PAM は、選択したサーバーを指すクラスター データベース内のデータベース マウント場所を更新します。

8.  PAM は、選択したサーバー上のアクティブ マネージャーにデータベース マスターになるよう要求を送信します。

9.  選択したサーバー上のアクティブ マネージャーは、Microsoft Exchange Replication サービスが以前のサーバーから最終ログをコピーしてマウント可能なフラグをデータベース用に設定することを試みるよう要求します。

10. Microsoft Exchange Replication サービスは、以前にデータベースのアクティブなコピーを保持していたサーバーからログをコピーします。

11. アクティブ マネージャーは、最大ログ生成番号をクラスター データベースから読み取ります。

12. Microsoft Exchange Information Store サービスが新しいアクティブなデータベース コピーをマウントします。

## サーバー フェールオーバー

サーバー フェールオーバーは、DAG メンバーが MAPI ネットワークの保守を実施できなくなるか、DAG メンバー上のクラスター サービスが残りの DAG メンバーに接続できなくなるときに行われます。サーバー フェールオーバーの一部として、以下のようになります。

1.  次の 2 つの条件のいずれかの場合、PAM 上のクラスター サービスが PAM に通知を送信します。
    
    1.  **ノード ダウン**   サーバーが到達できるが、DAG 操作に参加することができない。
    
    2.  **MAPI ネットワーク ダウン**   サーバーが MAPI ネットワーク経由で接続できないため、DAG 操作に参加できない。

2.  サーバーが到達可能であれば、PAM は影響を受けるサーバー上のアクティブ マネージャーに接続して、すべてのデータベースを直ちにマウント解除するよう要求します。

3.  影響を受ける各データベース コピー:
    
    1.  PAM は、DAG 内のすべてのサーバーからデータベース コピー状態を要求します。
    
    2.  PAM は、到達可能でアクティブなすべての DAG メンバーから応答を受信します。
    
    3.  PAM は、各応答側から最新のログ生成番号を照会することによって、応答しているすべてのサーバー間で最適なログ ソースを決定しようとします。
    
    4.  各サーバーがログ生成番号を応答します。

4.  PAM は、現在の検索インデックス カタログ状態をクラスター データベースから取得します。

5.  各データベース コピーのログ生成番号とカタログ状態に基づいて、PAM はアクティブ化する最適なコピーを選択します。

6.  PAM は、クラスター データベース内のデータベースのマウント場所を更新します。

7.  PAM は、1 つまたは複数のその他のサーバー上でアクティブ マネージャーと通信することによって、データベース フェールオーバーを開始します。

8.  選択したサーバー上のアクティブ マネージャーは、Microsoft Exchange Replication サービスが以前のサーバーから最終ログをコピーしてマウント可能なフラグを設定することを試みるよう要求します。

9.  データベースがマウント可能である場合、サーバー上のアクティブ マネージャーがデータベースをマウントします。

アクティブ マネージャーの最適なコピー選択プロセスの詳細については、「[アクティブ マネージャー](active-manager-exchange-2013-help.md)」を参照してください。

## データセンター フェールオーバー

Exchange 2010 のサイトの復元構成に伴う問題に対処するために、Exchange 2013 では大幅な変更が行われています。名前空間の単純化、サーバー役割の統合、クライアント アクセス サーバーと DAG 回復の分離 (Exchange 2013 では、名前空間を DAG と一緒に移動する必要はありません)、負荷分散に関する変更が行われた結果、Exchange 2013 では、単一のグローバル名前空間を使用できるなど、新しいサイト復元オプションを利用できるようになっています。さらに、Exchange 2013 では、メッセージング サービス コンポーネントを 2 つより多くの場所に展開すると、Exchange 2010 では手動での介入が必要となった障害に対し、自動フェールオーバーを実行するようにメッセージング サーバーを構成できます。

サイト復元の操作は、Exchange 2013 では簡素化されています。Exchange は、複数の IP アドレス、負荷分散 (および必要に応じて、サーバーをサービスに組み込んだり外したりする機能) を介して名前空間に組み込まれたフォールト トレランスを利用します。Exchange 2013 で行われている最も顕著な変更の 1 つは、名前解決の要求に応答して DNS サーバーが返す複数の IP アドレスをキャッシュする、クライアントの機能を利用することです。クライアントが複数の IP アドレスをキャッシュできる場合 (ほとんどの HTTP クライアントは、この機能があり、Exchange 2013 のほぼすべてのクライアント アクセス プロトコル (Outlook、Outlook Anywhere、EAS、EWS、OWA、EAC、RPS など) は HTTP ベースであるため)、サポートされているすべての HTTP クライアントが複数の IP アドレスを使用できます。したがって、クライアント側でのフェールオーバーを実現できます。名前解決中にクライアントに複数の IP アドレスを渡すように DNS を構成できます。クライアントが mail.contoso.com について問い合わせると、たとえば 2 つの IP アドレスまたは 4 つの IP アドレスが返ってきます。ただし、クライアントが数多く受け取る IP アドレスは確実にクライアントによって使用されます。これにより、IP アドレスの 1 つに障害が発生しても、他に 1 つ以上の IP アドレスへの接続を試すことができるためクライアントが改善されます。クライアントが 1 つの IP アドレスに接続しようとして失敗すると、約 20 秒間待機してから一覧の次の IP アドレスに対して試行します。したがって、プライマリ CAS アレイへの接続が失われた場合、セカンダリ CAS アレイの公開された IP アドレスがあれば、クライアントが自動的に回復されます (約 21 秒以内)。

最近の HTTP クライアント (この 10 年以内に登場したオペレーティング システムおよび Web ブラウザー) は、この冗長性を使用して自動的に機能します。HTTP スタックは FQDN に対する複数の IP アドレスを受け付けることができ、試行した最初の IP アドレスの失敗が重大な場合 (接続できないなど)、一覧の次の IP アドレスを試行します。軽微な失敗 (デバイスがパケットを取りこぼしたためサービスを中断する必要があるなどの、サービスの断続的な障害が原因により、セッションの確立後に接続が失われた) では、ユーザーはブラウザーを最新の情報に更新する必要があるかもしれません。

構成が適切であれば、フェールオーバーをクライアント レベルで実行できます。その場合、クライアントは、クライアント アクセス サーバーが動作している第 2 のデータセンターに自動的にリダイレクトされます。そしてそれらの動作しているクライアント アクセス サーバーは停止の影響を受けずにいる (切り替えをしないため) ユーザーのメールボックス サーバーに通信をプロキシで返します。サービスの回復作業をする代わりにサービスが自身で回復するため、問題の根本的な解決に集中できます (障害の発生した負荷分散装置の交換など)。

データセンター間で名前空間をフェールオーバーできるので、データセンターのフェールオーバーを実現するために必要なのは、複数のデータセンター間でメールボックス役割をフェールオーバーするメカニズムだけです。DAG のフェールオーバーが自動的に行われるようにするには、単に 2 つのデータセンター間で DAG が均等に分割されたソリューションを設計し、第 3 の場所に監視サーバーを配置して、DAG メンバーが含まれるデータセンター間のネットワークの状態に関係なく、いずれかのデータセンターの DAG メンバーによって調停できるようにすることです。重要な点として、3 番目の場所は、DAG メンバーが含まれる場所に影響を与えるネットワーク障害から分離されていなければなりません。

データセンターが 2 つしかなく、自動フェールオーバーを構成できるようにする場合、第 3 の場所として Microsoft Azure を使用できます。Azure 仮想ネットワークを作成し、マルチポイント VPN を使って 2 つのデータセンターに接続する必要があります。これにより、ミラーリング監視サーバーを Microsoft Azure 仮想マシン上に配置できるようになります。詳細については、「[DAG ミラーリング監視サーバーとしての Microsoft Azure VM の使用](using-a-microsoft-azure-vm-as-a-dag-witness-server-exchange-2013-help.md)」を参照してください。

