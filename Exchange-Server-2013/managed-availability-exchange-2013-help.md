---
title: '可用性管理: Exchange 2013 Help'
TOCTitle: 可用性管理
ms:assetid: ceb99e6f-6dca-446d-abfb-3e6fc6a72704
ms:mtpsurl: https://technet.microsoft.com/ja-jp/library/Dn482056(v=EXCHG.150)
ms:contentKeyID: 59895172
ms.date: 04/24/2018
mtps_version: v=EXCHG.150
ms.translationtype: HT
---

# 可用性管理

 

_**適用先:** Exchange Online, Exchange Server 2013 SP1_

_**トピックの最終更新日:** 2017-03-29_

ユーザーの電子メール エクスペリエンスの向上は、メッセージング システム管理者の主要な目的です。Microsoft Exchange Server 2013 組織の可用性と信頼性を確保するには、システムのすべての側面を能動的に監視し、検出された問題をすばやく解決する必要があります。以前のバージョンの Exchange では、重要なシステム コンポーネントの監視は、Microsoft System Center 2012 Operations Manager などの外部アプリケーションを使ってデータを収集し、収集したデータを分析した後、検出された問題に応じて回復アクションを提供するのが一般的でした。Exchange 2010 および以前のバージョンには、正常性マニフェストや相関エンジンが管理パックの形式で含まれていました。これらのコンポーネントを使うと、Operations Manager は特定のコンポーネントが正常か異常かを判定できます。Operations Manager は、Exchange 2010 に組み込まれた診断コマンドレット インフラストラクチャを使用して、システムのさまざまな側面に対して代理トランザクションも実行します。

Exchange 2013 では新しいアプローチが採用され、*可用性管理*と呼ばれる、組み込みの監視と回復アクションを持つ機能によって監視が行われ、エンドユーザー エクスペリエンスがネイティブに保持されるようになりました。

## 可用性管理

可用性管理は、*アクティブ監視*または*ローカル アクティブ監視*とも呼ばれ、組み込みの監視と回復アクションが Exchange 高可用性プラットフォームに統合されています。可用性管理は、問題が発生してシステムで発見されると、すぐにそれを検出して回復するように設計されています。Exchange での以前の外部監視向けソリューションやテクニックとは異なり、可用性管理は、問題の根本原因の識別や通知を試みません。その代わりに、次に示すユーザー エクスペリエンスの主要な 3 つの領域に対応する回復局面に力を集中します。

  - **可用性**   ユーザーがサービスにアクセスできるかどうか。

  - **待機時間**   ユーザー エクスペリエンスに影響が出るかどうか。

  - **エラー**   ユーザーが必要な操作を実行できるかどうか。

Exchange 2013 では、サーバーの役割が統合され、その他のアーキテクチャも変更されたため、以前のバージョンの Exchange で使われていた監視方法や正常性モデルは、新しいアプローチへの移行が必要になりました。可用性管理は、これらの変更に対応するため、ネイティブな正常性監視機能と回復ソリューションを提供するように設計されました。可用性管理は、切り離されたシステム個々の断片を監視するのではなく、エンド ツー エンドのユーザー エクスペリエンスを監視し、回復重視のアクションを通じてエンドユーザーのエクスペリエンスを保護します。

可用性管理は、すべての Exchange 2013 サーバー上で実行される内部プロセスです。1 秒ごとに数百もの正常性メトリックをポーリングし、分析します。異常が検出されても、ほとんどの場合は自動的に修正されます。しかし、可用性管理のみでは修正できない問題が発生する場合もあります。そのような問題が起きた場合、可用性管理はイベント ログを介して問題を管理者にエスカレートします。

可用性管理は、次の 2 つのサービスの形で実装されています。

  - **Exchange Health Manager サービス (MSExchangeHMHost.exe)**   ワーカー プロセスの管理に使用するコントローラ プロセスです。これを使ってワーカー プロセスを必要に応じて構築、実行、開始、および停止します。また、ワーカー プロセスが停止した場合の回復や、ワーカー プロセスが単一障害点になることを防ぐためにも使用されます。

  - **Exchange Health Manager ワーカー プロセス (MSExchangeHMWorker.exe)**   可用性管理フレームワーク内部のランタイム タスクの実行を担当するワーカー プロセスです。

可用性管理では、永続的なストレージを使用してその機能を実行します。

  - \\bin\\Monitoring\\config フォルダーにある XML ファイルを使って、プローブと監視の一部の作業項目の構成設定を格納します。

  - Active Directory を使って、グローバル オーバーライドを格納します。

  - Windows レジストリを使って、ブックマークなどのランタイム データ、ローカル (サーバー固有の) オーバーライドを格納します。

  - Windows クリムゾン チャネル イベント ログ インフラストラクチャを使用して、作業項目の結果を格納します。

  - 正常性メールボックスは、プローブ アクティビティに使われます。複数の正常性メールボックスが、サーバーに存在する各メールボックス データベースに作成されます。

次の図に示すように、可用性管理は、常時稼働する 3 つの主要非同期コンポーネントを含みます。

**可用性管理のコンポーネント**

![Exchange Server 2013 における可用性管理](images/Dn482056.7a54dcb5-1e28-4bd4-87e6-0d496b4ab796(EXCHG.150).gif "Exchange Server 2013 における可用性管理")

1 つ目のコンポーネントは*プローブ*と呼ばれています。プローブは、サーバー上の測定とデータの収集を担当します。それらの測定結果が 2 番目のコンポーネントである*モニター*に渡ります。モニターには、収集したデータで正常と判断される項目に基づいて、システムで使用されるビジネス ロジックのすべてが含まれています。モニターは、パターン認識エンジンと同様に、収集したすべての測定値についてさまざまなパターンを探し出し、対象が正常と判断されるかどうかの決定を下すことができます。最後に、回復操作とエスカレーション操作を担当する*レスポンダー*が控えています。異常が検出された場合、最初のアクションはそのコンポーネントを回復しようとします。回復操作は、複数の段階で行われる場合があります。たとえば、最初の段階でアプリケーション プールの再起動を試行し、第 2 段階でサービスの再起動を試行し、第 3 段階でサーバーの再起動を試行します。その次の段階ではサーバーをオフラインにし、それ以上トラフィックを受信しないようにします。これらの回復操作が失敗すると、イベント ログ通知を介して問題を人的対応レベルにエスカレートします。

プローブには、主に、反復プローブ、通知、およびチェックの 3 つのカテゴリがあります。反復プローブは、システムがエンド ツー エンドのユーザー エクスペリエンスをテストするための代理トランザクションです。チェックは、ユーザー トラフィックなどのパフォーマンス データを収集し、ユーザー障害の急激な上昇を判定するために設定されるしきい値を基準にして収集したデータを測定するインフラストラクチャです。このような仕組みにより、チェック インフラストラクチャは、ユーザーがどの状態で問題を経験するのかを認識できます。また、クリティカルなイベントが発生した場合は、通知ロジックにより、プローブが収集したデータの結果を待つことなく迅速に対応できます。これらは、通常、大量のサンプル セットがなくても検出および認識できる、例外または条件です。

反復プローブは、数分おきに起動して、サービス正常性のいくつかの側面をチェックします。このプローブは、Exchange ActiveSync 経由の電子メールを監視対象メールボックスに送信したり、RPC エンドポイントに接続したり、メールボックスに対するクライアント アクセスの接続を確認したりします。

すべてのプローブが Microsoft.Exchange.ActiveMonitoring\\ProbeDefinition クリムゾン チャネルでの Health Manager サービスの起動時に定義されます。各プローブ定義にはさまざまなプロパティが含まれていますが、最も重要なプロパティは次のとおりです。

  - **Name** プローブの名前。プローブのモニターの *SampleMask* で始まります。

  - **TypeName** プローブのロジックを含むプローブのコード オブジェクトの種類です。

  - **ServiceName** このプローブを含む正常性セットの名前。

  - **TargetResource** プローブが検証するオブジェクト。これが実行時にプローブの名前に付加され、プローブ結果の *ResultName* になります。

  - **RecurrenceIntervalSeconds** プローブの実行頻度。

  - **TimeoutSeconds** プローブが失敗したと判断されるまでの時間。

何百もの反復プローブがあります。これらのプローブの多くはデータベース単位のため、データベースの数が増えるほど、プローブの数も増えます。ほとんどのプローブは、コード内で定義されるため、直接検出することはできません。

反復プローブの原理は次のとおりです。*RecurrenceIntervalSeconds* おきに起動して、正常性のいくつかの側面をチェック (または調査) します。コンポーネントが正常な場合は、プローブは情報イベントを Microsoft.Exchange.ActiveMonitoring\\ProbeResult チャネルに渡して *ResultType* 3 で書き込みます。チェックが失敗するか、タイムアウトすると、プローブが失敗して、同じチャネルにエラー イベントが書き込まれます。*ResultType* 4 はチェックの失敗を意味し、*ResultType* 1 はチェックのタイムアウトを意味します。複数のプローブがタイムアウトしても、*MaxRetryAttempts* プロパティの値まで再実行されます。


> [!NOTE]
> <STRONG>メモ</STRONG> ProbeResult クリムゾン チャネルは何百ものプローブが数分おきに起動してイベントをログに記録することによって非常に忙しくなる可能性があるため、実稼働環境のイベント ログに対して負荷のかかる問い合わせを実行すると、Exchange サーバーのパフォーマンスに重大な影響が出る可能性があります。



通知は、Health Manager フレームワークによってではなく、サーバー上の他のサービスによって実行されるプローブです。このサービスは、独自の監視を実施してから、プローブ結果を直接書き込むことによって、そのデータを可用性管理フレームワークにフィードします。このプローブは ProbeDefinition チャネルに表示されません。これは、このチャネルには可用性管理フレームワークによって実行されるプローブしか表示されないためです。たとえば、ServerOneCopyMonitor モニターは、MSExchangeDAGMgmt サービスによって書き込まれたプローブ結果によってトリガーされます。このサービスは、独自の監視を実施して、問題があるかどうかを判断し、プローブ結果をログに記録します。ほとんどの通知プローブは、モニター異常を引き起こす赤色のイベントとモニターを正常に戻す緑色のイベントの両方をログに記録する機能を備えています。

チェックは、パフォーマンス カウンターが定義済みのしきい値を上回ったまたは下回ったイベントのみをログに記録するプローブです。実際には、このプローブは通知プローブの特殊なケースであり、サーバー上のパフォーマンス カウンターを監視して、構成済みのしきい値を超えたときに ProbeResult チャネルにイベントを書き込むサービスが存在します。

異常と見なされるカウンターとしきい値を見つけるには、このチェック用のモニターを参照します。種類が *Microsoft.Office.Datacenter.ActiveMonitoring.OverallConsecutiveSampleValueAboveThresholdMonitor* または *Microsoft.Office.Datacenter.ActiveMonitoring.OverallConsecutiveSampleValueBelowThresholdMonitor* のモニターは、監視しているプローブがチェック プローブであることを意味します。

モニターは、プローブが収集したデータをクエリして、事前定義のルール セットに基づき、対応が必要かどうかを判断します。モニターは、ルールまたは問題の特性に基づいて、レスポンダーを起動するか、問題をイベント ログのエントリを介して人的対応レベルにエスカレートできます。また、モニターは障害発生後のレスポンダーの実行時間や回復操作のワークフローを定義します。モニターにはさまざまな状態があります。システム状態の観点から見ると、モニターの状態は次の 2 つです。

  - **正常** モニターは、適切に動作し、収集される測定値がすべて正常な稼働パラメーターの範囲内にある。

  - **異常** モニターは正常ではなく、レスポンダーを介して回復を開始しているかまたは問題レベルのエスカレートによって管理者に通知している。

管理の観点から見ると、上記の状態に加え、シェルに表示されるモニターの状態もあります。

  - **低下**   モニターの正常でない状態が 0 ～ 60 秒間続くと、そのモニターは低下と見なされます。モニターの正常でない状態が 60 秒を超えると、モニターは異常と見なされます。

  - **無効**   モニターは管理者が明示的に無効にしています。

  - **使用不可能**   Microsoft Exchange Health サービスは、定期的に各モニターにクエリしてその状態を確認します。クエリに対する応答がない場合、モニターの状態は「使用不可能」になります。

  - **修復**   担当者による修復措置が進行中であることをシステムに示すために管理者が修復状態を設定しています。この設定により、システムや担当者は、データベース コピーの再シード操作など、修復措置が行われているときに発生する可能性がある他の障害間での区別を行うことができます。

すべてのモニターの定義に *SampleMask* プロパティが含まれています。モニターが起動すると、その *SampleMask* と一致する *ResultName* を持つ ProbeResult チャネルでイベントが検索されます。これらのイベントは、反復プローブ、通知、またはチェックで検出されたものです。モニターのしきい値に到達すると、異常と見なされます。モニターの観点では、3 つすべてのプローブの種類が ProbeResult チャネルに書き込まれる種類と一致します。

1 つのプローブ エラーが必ずしもサーバーに問題があることを示しているわけではないことは注目に値します。修正が必要な実際の問題の存在を正しく特定できるかどうかはモニターの設計にかかっています。これが、異常と判断するには、多くのモニターで複数のプローブ エラーのしきい値がモニターされる理由です。それでも、これらの問題の多くがレスポンダーによって自動的に修復される可能性があるため、人間の介在が必要な問題を見つける最良の場所は Microsoft.Exchange.ManagedAvailability\\Monitoring クリムゾン チャネルです。このチャネルには、最新のプローブ エラーが含まれています。

その名前が示すとおり、レスポンダーは、モニターから生成される警告への応答を実行します。レスポンダーは、アプリケーションのワーカー プールのリセット、サーバーの再起動など、さまざまな回復操作を実行します。さまざまな種類のレスポンダーがあります。

  - **再起動レスポンダー** サービスを終了し、サービスを再起動します。

  - **アプリケーション プール リセット レスポンダー** インターネット インフォメーション サービス (IIS) のアプリケーション プールを停止、再起動します。

  - **フェールオーバー レスポンダー** データベースまたはサーバーのフェールオーバーを開始します。

  - **バグ チェック レスポンダー** サーバーのバグチェックを開始します。これにより、サーバーを再起動します。

  - **オフライン レスポンダー** サーバーのプロトコルをサービス停止 (クライアントからの要求を拒否) にします。

  - **オンライン レスポンダー** サーバーのプロトコルを稼働状態に戻します (クライアントからの要求を受け付ける)。

  - **エスカレート レスポンダー** イベント ログを介して管理者に問題をエスカレートします。

上記のレスポンダーに加えて、一部のコンポーネントには、コンポーネントに固有の特殊なレスポンダーがあります。

すべてのレスポンダーには、調整機能が含まれています。この調整機能は、組み込みの優先順位メカニズムを提供してレスポンダーのアクションを制御します。調整機能は、レスポンダーが実行した回復操作の結果として、システムの障害やパフォーマンスの低下が生じないようにするための機能です。すべてのレスポンダーには、何らかの方法で調整が行われます。調整が行われると、レスポンダーのアクションに応じて、回復アクションがスキップされたり、遅延する場合があります。たとえば、バグ チェック レスポンダーで調整が行われると、レスポンダーのアクションはスキップされます。遅延されることはありません。

## 正常性セット

可用性管理をレポートの観点から見ると、正常性には 2 つのビューがあります。1 つは内部ビューで、もう 1 つは外部ビューです。内部ビューでは、*正常性セット*を使います。Exchange 2013 の各コンポーネント (たとえば、Outlook Web App、Exchange ActiveSync、Information Store サービス、コンテンツのインデックス処理、トランスポート サービスなど) は、プローブ、モニター、レスポンダーを使って可用性管理によって管理されます。特定のコンポーネントのプローブ、モニター、レスポンダーから成るグループを*正常性セット*と呼びます。正常性セットは、一連のプローブ、モニター、レスポンダーであり、そのコンポーネントが正常かどうかを判断します。正常性セットの現在の状態 (たとえば、正常または異常) は、正常性セットのモニターの状態によって判断されます。正常性セットのすべてのモニターが正常であれば、正常性セットの状態は正常です。いずれかのモニターが異常な状態を示す場合、正常性セットの状態は、最も大きな異常を示すモニターによって判断されます。

サーバーの正常性または正常性セットの状態を表示する詳細な手順については、「[正常性セットおよびサーバーの状態の管理](manage-health-sets-and-server-health-exchange-2013-help.md)」を参照してください。

## 正常性グループ

可用性管理の外部ビューは、*ヘルス グループ*で構成されます。正常性グループは、System Center Operations Manager 2007 R2 と System Center Operations Manager 2012 に公開されます。

主要な正常性グループは、以下の 4 つです。

  - **顧客タッチ ポイント** リアルタイムのユーザー操作に影響するコンポーネント。プロトコル、インフォメーション ストアなど。

  - **サービス コンポーネント** 直接的なリアルタイムのユーザー操作を伴わないコンポーネント。Microsoft Exchange Mailbox Replication サービス、オフライン アドレス帳の生成プロセス (OABGen) など。

  - **サーバー コンポーネント** サーバーの物理リソース。ディスク領域、メモリ、ネットワークなど。

  - **依存関係の可用性** 必要な依存関係にアクセスするサーバー機能。Active Directory、DNS など。

Exchange 管理パックをインストールした場合、System Center Operations Manager (SCOM) は、Exchange 環境に関連する情報を参照する正常性ポータルとして機能します。SCOM ダッシュボードでは、Exchange サーバーの正常性を以下の 3 つのビューで確認できます。

  - **アクティブなアラート** エスカレーション レスポンダーは Windows イベント ログにイベントを書き込み、それらは SCOM 内でモニターによって使用されます。これらは \[アクティブなアラート\] ビューにアラートとして表示されます。

  - **組織の状態** このビューには、Exchange 組織の全体的な正常性を表すロールアップ サマリーが表示されます。これらのロールアップには、個々のデータベース可用性グループの正常性、および特定の Active Directory サイト内の正常性が表示されます。

  - **サーバーの状態** 関連する正常性セットの組み合わせが正常性グループとして集計され、このビューに表示されます。

## オーバーライド

管理者はオーバーライドを使って、可用性管理のプローブ、モニター、レスポンダーのいくつかの側面を構成できます。オーバーライドにより、可用性管理で使用するしきい値の一部を調整できます。また、予想外のイベントが発生して既定値とは異なる構成設定が必要となった場合、緊急の処置をとるために使用することもできます。

オーバーライドを作成し、単一のサーバーに適用する (*サーバー オーバーライド*)、またはサーバーのグループに適用する (*グローバル オーバーライド*) ことができます。サーバー オーバーライドの構成データは、オーバーライドを適用するサーバー上の Windows レジストリに格納されます。グローバル オーバーライドの構成データは、Active Directory に格納されます。

有効期間に制限のないオーバーライド、または特定の期間を対象とするオーバーライドを構成できます。グローバル オーバーライドは、すべてのサーバーに適用するか、特定のバージョンの Exchange を実行しているサーバーのみに適用するように構成できます。

オーバーライドを構成しても、すぐには有効になりません。Microsoft Exchange Health Manager サービスは、10 分ごとに構成データが更新されたかどうかをチェックします。さらに、グローバル オーバーライドは、Active Directory のレプリケーションの待機時間にも左右されます。

サーバー オーバーライドまたはグローバル オーバーライドの表示や構成の詳細な手順については、「[可用性管理のオーバーライドを構成する](configure-managed-availability-overrides-exchange-2013-help.md)」を参照してください。

## 管理タスクおよびコマンドレット

管理者は通常、可用性管理に関連する 3 つの主要な運用タスクを実行します。

  - システム正常性の抽出または表示。

  - 正常性セットの表示、プローブ、モニター、レスポンダーの詳細の表示。

  - オーバーライドの管理。

可用性管理の 2 つの主な管理ツールは、Windows イベント ログとシェルです。可用性管理は、Exchange ActiveMonitoring および ManagedAvailability クリムゾン チャネルのイベント ログに、膨大な情報を記録します。次に例を示します。

  - プローブ、モニター、レスポンダーの定義は、それぞれの \*Definition イベント ログに記録されます。

  - プローブ、モニター、レスポンダーの結果は、それぞれの \*Results イベント ログに記録されます。

  - レスポンダーの回復操作の開始時刻、操作が完了したと見なされる時刻 (成功したかどうかにかかわらず) などを含む回復操作の詳細は、RecoveryActionResults イベント ログに記録されます。

次の表に、可用性管理で使用される 12 個のコマンドレットを示します。


<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="header">
<th>コマンドレット</th>
<th>説明</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p><a href="https://technet.microsoft.com/ja-jp/library/jj218703(v=exchg.150)">Get-ServerHealth</a></p></td>
<td><p>正常性セットとその現在の状態 (正常または異常)、正常性セットのモニター、サーバー コンポーネント、プローブのターゲット リソース、プローブまたはモニターの開始と終了の時間に関するタイムスタンプ、状態遷移時間など、生のサーバーの正常性に関する情報の取得に使用します。</p></td>
</tr>
<tr class="even">
<td><p><a href="https://technet.microsoft.com/ja-jp/library/jj218724(v=exchg.150)">Get-HealthReport</a></p></td>
<td><p>正常性セットとその現在の状態を含む正常性の表示の概要を取得に使用します。</p></td>
</tr>
<tr class="odd">
<td><p><a href="https://technet.microsoft.com/ja-jp/library/jj218668(v=exchg.150)">Get-MonitoringItemIdentity</a></p></td>
<td><p>特定の正常性セットに関連するプローブ、モニター、レスポンダーの表示に使用します。</p></td>
</tr>
<tr class="even">
<td><p><a href="https://technet.microsoft.com/ja-jp/library/jj218642(v=exchg.150)">Get-MonitoringItemHelp</a></p></td>
<td><p>プローブ、モニター、レスポンダーの一部のプロパティについての説明の表示に使用します。</p></td>
</tr>
<tr class="odd">
<td><p><a href="https://technet.microsoft.com/ja-jp/library/jj218628(v=exchg.150)">Add-ServerMonitoringOverride</a></p></td>
<td><p>プローブ、モニター、またはレスポンダーのローカルのサーバー固有のオーバーライドの作成に使用します。</p></td>
</tr>
<tr class="even">
<td><p><a href="https://technet.microsoft.com/ja-jp/library/jj218664(v=exchg.150)">Get-ServerMonitoringOverride</a></p></td>
<td><p>指定されたサーバーのローカル オーバーライドの一覧の表示に使用します。</p></td>
</tr>
<tr class="odd">
<td><p><a href="https://technet.microsoft.com/ja-jp/library/dn482411(v=exchg.150)">Remove-ServerMonitoringOverride</a></p></td>
<td><p>特定のサーバーからのローカル オーバーライドの削除に使用します。</p></td>
</tr>
<tr class="even">
<td><p><a href="https://technet.microsoft.com/ja-jp/library/jj218683(v=exchg.150)">Add-GlobalMonitoringOverride</a></p></td>
<td><p>サーバー グループのグローバル オーバーライドの作成に使用します。</p></td>
</tr>
<tr class="odd">
<td><p><a href="https://technet.microsoft.com/ja-jp/library/jj218627(v=exchg.150)">Get-GlobalMonitoringOverride</a></p></td>
<td><p>組織内で構成されたグローバル オーバーライドの一覧の表示に使用します。</p></td>
</tr>
<tr class="even">
<td><p><a href="https://technet.microsoft.com/ja-jp/library/jj218675(v=exchg.150)">Remove-GlobalMonitoringOverride</a></p></td>
<td><p>グローバル オーバーライドの削除に使用します。</p></td>
</tr>
<tr class="odd">
<td><p><a href="https://technet.microsoft.com/ja-jp/library/jj218699(v=exchg.150)">Set-ServerComponentState</a></p></td>
<td><p>1 つ以上のサーバー コンポーネントの状態の構成に使用します。</p></td>
</tr>
<tr class="even">
<td><p><a href="https://technet.microsoft.com/ja-jp/library/jj218713(v=exchg.150)">Get-ServerComponentState</a></p></td>
<td><p>1 つ以上のサーバー コンポーネントの状態の表示に使用します。</p></td>
</tr>
</tbody>
</table>

