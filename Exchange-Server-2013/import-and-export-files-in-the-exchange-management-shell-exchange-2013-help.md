---
title: 'Exchange 管理シェルでのファイルのインポートとエクスポート: Exchange 2013 Help'
TOCTitle: Exchange 管理シェルでのファイルのインポートとエクスポート
ms:assetid: b4b669e8-a3aa-4b0b-ad34-f1f15d9c9369
ms:mtpsurl: https://technet.microsoft.com/ja-jp/library/Dd638170(v=EXCHG.150)
ms:contentKeyID: 50555856
ms.date: 05/23/2018
mtps_version: v=EXCHG.150
ms.translationtype: MT
---

# Exchange 管理シェルでのファイルのインポートとエクスポート

 

_**適用先:**Exchange Server 2013_

_**トピックの最終更新日:**2015-03-09_

Microsoft Exchange Server 2013 は、Windows PowerShell コマンドライン インターフェイスのリモート処理を使用して、Exchange を管理しているサーバー/ワークステーションと管理対象の Exchange 2013 を実行しているサーバー間での接続を確立します。Exchange 2013 では、これをリモート Exchange 管理シェルまたはリモート シェルと呼びます。ローカルの Exchange 2013 サーバーを管理している場合でも、リモート シェルを使用して接続を行います。ローカルおよびリモート シェルの詳細については、「[Exchange 2013 で Powershell を使用する (Exchange 管理シェル)](https://technet.microsoft.com/ja-jp/library/bb123778\(v=exchg.150\))」を参照してください。

Exchange 2013 で Exchange サーバーのファイルをインポートおよびエクスポートする方法は、Exchange Server 2007 での方法とは異なります。これは、Exchange 2013 ではリモート シェルを使用するためです。ここでは、この新しい処理が必要な理由、およびローカル サーバーまたはワークステーションと Exchange 2013 サーバーとの間でファイルのインポートおよびエクスポートを実行する方法について説明します。

## Windows PowerShell セッション

リモート シェルでファイルのインポートとエクスポートを行う場合に、なぜ特別な構文が必要なのかを理解するには、シェルが Exchange 2013 でどのように実装されているのかを知る必要があります。シェルは Windows PowerShell セッションを使用します。これは、変数、コマンドレットなどが情報を共有できる環境です。新しいシェル ウィンドウを開くと、そのたびに新しいセッションが作成されます。各ウィンドウで実行されているコマンドレットは、そのウィンドウ内に保存された変数およびその他の情報にアクセスできますが、開いている他のシェル ウィンドウ内の変数にアクセスすることはできません。これは、それぞれ独自の Windows PowerShell セッションに含まれているためです。Windows PowerShell セッションは実行空間として参照することもできます。

Exchange 2013 のリモート シェルには、ローカル セッションとリモート セッションの 2 つのセッションがあります。ローカル セッションは、ローカル コンピューター上で実行される Windows PowerShell セッションです。このセッションには、Windows PowerShell に付属するすべてのコマンドレットが含まれています。また、ローカル ファイル システムへのアクセスも可能です。

リモート セッションは、リモート Windows サーバー上で実行される Exchange PowerShell セッションです。このセッションは、すべての Exchange コマンドレットの実行場所です。Exchange サーバーのファイル システムにアクセス可能です。

リモート Exchange サーバーに接続すると、コンピューター上のローカル セッションと Exchange サーバー上のリモート セッションとの間に接続が確立されます。この接続により、ローカル コンピューター上に Exchange コマンドレットがインストールされていなくても、ローカル セッション時にリモート Exchange サーバーで Exchange コマンドレットを実行することが可能になります。Exchange コマンドレットはローカル コンピューター上で実行しているように見えますが、実際は Exchange サーバー上で実行しています。


> [!IMPORTANT]
> Exchange 2013&nbsp;サーバーでシェルを開く場合でも、同じ接続処理が実行され、2 つのセッションが作成されます。そのため、シェルを Exchange 2013 サーバー上またはリモート クライアント ワークステーションからのいずれで開く場合も、ファイルをインポートおよびエクスポートするには、同じ新しい構文を使用する必要があります。



リモート セッション時にリモート Exchange サーバー上で実行されている Exchange コマンドレットは、ローカル ファイル システムにアクセスすることはできません。そのため、Exchange コマンドレットを単独で使用して、ローカル ファイル システムでのファイルのインポートとエクスポートを行うことはできません。リモート Exchange サーバーで実行されている Exchange コマンドレットがデータを使用できるようにするには、追加の構文を使用して、ローカル ファイル システムとファイルのやり取りを行う必要があります。必要な構文の詳細については、このトピックの「リモート シェルでのファイルのインポートとエクスポート」を参照してください。

## リモート シェルでのファイルのインポートとエクスポート

メールボックス サーバーおよびクライアント アクセス サーバーはリモート シェルを使用し、ローカル コンピューターのファイル システムにアクセスできないため、ファイルのインポートおよびエクスポートを行うには、固有の構文が必要になります。

## リモート シェルでのファイルのインポート

ローカル コンピューターまたはサーバーから、Exchange 2013 サーバーで実行されているコマンドレットにファイルを送信する場合は常に、Exchange 2013 にファイルをインポートするための構文を使用します。ローカル コンピューター上のファイルのデータを許可するコマンドレットは、*FileData* というパラメーター (または、類似のパラメーター) を持ちます。使用する適切なパラメーターを確認するには、使用しているコマンドレットのヘルプ情報を参照してください。

Exchange 2013 コマンドレットに送信するファイル、およびデータを許可するパラメーターを、シェルに認識させる必要があります。それには、次の構文を使用します。

    <Cmdlet> -FileData ([Byte[]]$(Get-Content -Path <local path to file> -Encoding Byte -ReadCount 0))

たとえば、次のコマンドにより、**Import-SomeData** 架空コマンドレット上の *FileData* パラメーターに、ファイル C:\\MyData.dat がインポートされます。

    Import-SomeData -FileData (Byte[]]$(Get-Content -Path "C:\MyData.dat" -Encoding Byte -ReadCount 0))

コマンドが実行されると、次のアクションが発生します。

1.  コマンドは、リモート シェルによって受け付けられます。

2.  リモート シェルはコマンドを評価して、*FileData* パラメーターに指定されている値に埋め込みコマンドがあることを確認します。

3.  リモート シェルは **Import-SomeData** コマンドの評価を停止し、**Get-Content** コマンドを実行します。**Get-Content** コマンドは MyData.dat ファイルからデータを読み取ります。

4.  リモート シェルは、**Get-Content** コマンドからのデータを `Byte[]` オブジェクトとして一時的に保存し、**Import-SomeData** コマンドレットにデータを渡すことができるようにします。

5.  **Import-SomeData** コマンドの実行を再開します。リモート シェルは、**Import-SomeData** コマンドレットを実行するための要求を、**Get-Content** コマンドレットによって作成されたオブジェクトと共にリモート Exchange 2013 サーバーに送信します。

6.  リモート Exchange 2013 サーバーで **Import-SomeData** コマンドレットが実行され、**Get-Content** コマンドレットで作成された一時オブジェクトに保存してあるデータが、*FileData* パラメーターに渡されます。**Import-SomeData** コマンドレットは入力を処理し、要求された操作はすべて実行します。

一部のコマンドレットでは、次に示すように、前述の構文と同じ処理をする代替の構文が使用されます。

    [Byte[]]$Data = Get-Content -Path <local path to file> -Encoding Byte -ReadCount 0
    Import-SomeData -FileData $Data

この代替の構文を使用しても、発生するプロセスは同じです。唯一の違いは、操作全体が一度に実行されず、ローカル ファイルから取得されたデータが、作成後に参照可能な変数に保存されることです。次に、ローカル ファイルの内容を **Import-SomeData** コマンドレットに渡すために、変数がインポート コマンドで使用されます。この 2 つの手順からなるプロセスは、ローカル ファイルのデータを複数のコマンドで使用する場合に役立ちます。

ファイルをインポートする際に、考慮する必要がある制限事項があります。詳細については、このトピックの「ファイルのインポートに関する制限事項」を参照してください。

Exchange 2013 へのデータのインポート方法の詳細については、管理している機能のヘルプ トピックを参照してください。

## ファイルのインポートに関する制限事項

転送中のデータの整合性を維持するには、リモート シェルでデータをインポートする際に制限事項を設定する必要があります。進行中の転送が中断している場合、再開することはできません。また、転送中のデータはリモート サーバーのメモリに保存されるので、過度に大量のデータによってメモリが消費されないようにサーバーを保護する必要があります。

これらの理由により、ローカル コンピューターまたはサーバーからリモート Exchange 2013 サーバーに転送されるデータの量は次のように制限されます。

  - 実行されるコマンドレットごとに 500 メガバイト (MB)

  - コマンドレットに渡されるオブジェクトごとに 75 MB

これらの制限のいずれかを超過すると、コマンドレットおよび関連するパイプラインの実行が停止され、エラーが表示されます。次の表の例を参照して、これらの制限がどのように機能するかを理解してください。

### データのインポート時の制限例

<table>
<colgroup>
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
</colgroup>
<thead>
<tr class="header">
<th>オブジェクトの数</th>
<th>オブジェクトのサイズ (MB)</th>
<th>合計サイズ (MB)</th>
<th>操作の結果</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p>10</p></td>
<td><p>40</p></td>
<td><p>400</p></td>
<td><p>個々のオブジェクトのサイズが 75 MB を超過せず、コマンドレットに渡されたデータの総量も 500 MB を超えていないので、操作は正常に実行されます。</p></td>
</tr>
<tr class="even">
<td><p>5</p></td>
<td><p>80</p></td>
<td><p>400</p></td>
<td><p>コマンドレットに渡されたデータの総量は 400 MB のみですが、個別の各オブジェクトのサイズが 75 MB 制限を超えているので、操作に失敗します。</p></td>
</tr>
<tr class="odd">
<td><p>120</p></td>
<td><p>5</p></td>
<td><p>600</p></td>
<td><p>個別の各オブジェクトは 5 MB のみですが、コマンドレットに渡されたデータの総量が 500 MB 制限を超えているので、操作に失敗します。</p></td>
</tr>
</tbody>
</table>


リモート Exchange 2013 サーバーとローカル コンピューターとの間で転送できるデータ量のサイズ制限により、以前インポートをサポートしていたコマンドレットであっても、すべてがこのデータ転送方法をサポートするとは限りません。特定のコマンドレットがこの方法をサポートしているかどうかを確認するには、その特定のコマンドレットのヘルプ情報を参照してください。

Exchange 2013 サーバーで実行できる通常の操作の大半を、これらの制限の対象とする必要があります。制限を低くすると、一部の通常の操作は新しい制限を超過するので、失敗する可能性があります。制限を上げると、データの転送にかかる時間が長くなる可能性があり、データ転送を中断する一時的な状態に陥るリスクが高まります。また、転送中のデータのブロック全体をサーバーで保存できるように、十分な容量のメモリをインストールしていないと、リモート サーバー上のメモリが使い果たされる可能性があります。それぞれの結果、データ損失が発生するおそれがあるので、既定の制限は変更しないことをお勧めします。

## リモート シェルでのファイルのエクスポート

リモート Exchange 2013 サーバーで実行されているコマンドレットのデータを許可して、ローカル コンピューターまたはサーバー上でそのデータを保存する場合は、常に Exchange 2013 にファイルをエクスポートするための構文が使用されます。ローカル ファイルに保存できるデータを提供するコマンドレットは、オブジェクトを出力します。このオブジェクトに、**FileData** プロパティ (または類似のプロパティ) が含まれます。コマンドレットによっては、特定の状況下で出力されたオブジェクトにのみ **FileData** プロパティが含まれることがあります。使用する適切なプロパティおよびプロパティを使用できる場合を確認するには、使用しているコマンドレットのヘルプ情報を参照してください。

**FileData** プロパティに保存されたデータをローカル コンピューターに保存することを、シェルに認識させる必要があります。それには、次の構文を使用します。

    <cmdlet> | ForEach { $_.FileData | Add-Content <local path to file> -Encoding Byte }

たとえば、次のコマンドにより、オブジェクトの **FileData** プロパティに保存されたデータは、**Export-SomeData** 架空コマンドレットによって作成されたオブジェクトにエクスポートされます。エクスポートされたデータは、ローカル コンピューター上で指定するファイル、この場合は MyData.dat に保存されます。


> [!NOTE]
> この手順では、<STRONG>ForEach</STRONG> コマンドレット、オブジェクト、およびパイプライン処理を使用します。それぞれの詳細については、「<A href="https://technet.microsoft.com/ja-jp/library/aa998260(v=exchg.150)">パイプライン処理</A>」および「<A href="https://technet.microsoft.com/ja-jp/library/aa996386(v=exchg.150)">構造化データ</A>」を参照してください。



    Export-SomeData | ForEach { $_.FileData | Add-Content C:\MyData.dat -Encoding Byte }

コマンドが実行されると、次のアクションが発生します。

1.  コマンドは、リモート シェルによって受け付けられます。

2.  リモート シェルは **Export-SomeData** コマンドレットをリモート Exchange 2013 サーバー上で呼び出します。

3.  **Export-SomeData** コマンドレットによって作成された出力オブジェクトは、パイプラインによってローカル シェル セッションに戻されます。

4.  次に、出力オブジェクトはパイプ処理によって、スクリプト ブロックのある **ForEach** コマンドレットに渡されます。

5.  パイプライン内の現在のオブジェクトの **FileData** プロパティは、スクリプト ブロック内でアクセスされます。**FileData** プロパティ内に含まれているデータはパイプ処理されて、**Add-Content** コマンドレットに渡されます。

6.  **Add-Content** コマンドレットは、**FileData** プロパティからパイプ処理されたデータを、ローカル ファイル システム上のファイル MyData.dat に保存します。

Exchange 2013 からのデータのエクスポート方法の詳細については、管理している機能のヘルプ トピックを参照してください。

