---
title: 'Active Directory サイト間でメールをルーティングする: Exchange 2013 Help'
TOCTitle: Active Directory サイト間でメールをルーティングする
ms:assetid: 86b423e3-7bec-4430-9a5a-4f84ce9d82ea
ms:mtpsurl: https://technet.microsoft.com/ja-jp/library/JJ916681(v=EXCHG.150)
ms:contentKeyID: 52057827
ms.date: 04/24/2018
mtps_version: v=EXCHG.150
ms.translationtype: HT
---

# Active Directory サイト間でメールをルーティングする

 

_**適用先:** Exchange Server 2013_

_**トピックの最終更新日:** 2016-12-09_

Active Directory サイトは、ネットワークの物理面に基づいた論理的な構成コンポーネントです。Active Directory サイトを作成する主な目的は、Active Directory レプリケーション トラフィックの制御が最適化されるように、ネットワーク内のサブネット接続を定義することです。Microsoft Exchange Server 2013 はデータベース可用性グループ (DAG) と Active Directory サイトの両方をルーティング境界として認識し、Exchange 2013 サーバーは Active Directory サイト トポロジに基づいてルーティングを決定します。

既定では、Active Directory フォレストに含まれる Active Directory サイトは 1 つのみです。この Active Directory サイトの既定の名前は `Default-First-Site-Name` です。その他の Active Directory サイトを作成しない場合、フォレスト内のすべてのドメイン メンバー コンピューターは、`Default-First-Site-Name` のメンバーになります。この場合、サブネットとサイトの関連付けを構成する必要はありません。追加の Active Directory サイトを作成する場合は、その Active Directory サイトに割り当てるサブネットを指定する必要があります。

**目次**

サイト メンバーシップの確認

IP サイト リンク

IP サイト リンクのコストの制御

ハブ サイトの実装

トポロジ検出

## サイト メンバーシップの確認

各 Active Directory サイトは、1 つ以上の IP サブネットに関連付けられます。管理者は Active Directory サイト メンバーシップを、ドメイン コントローラーおよびグローバル カタログ サーバーとして構成されているコンピューターに割り当てます。Exchange サーバーなどの他のドメイン メンバー コンピューターは、Active Directory サイトに関連付けられている IP サブネット内にある IP アドレスを使用するように構成されると、自動的に Active Directory サイト メンバーシップが割り当てられます。同じ Active Directory サイト メンバーシップを持つコンピューターは、ネットワーク接続が良好であると仮定されます。常に、サーバーは単一の Active Directory サイトのメンバーになります。

アプリケーションが、インストールされているコンピューターおよびフォレスト内にある他のコンピューターの Active Directory サイト メンバーシップを確認し、通信フローを制御するために情報を使用できる場合、それはサイト対応のアプリケーションです。サイト対応のアプリケーションがドメイン コントローラーやグローバル カタログ サーバーなどの別のサーバーのサービスを使用する必要がある場合、それらのサービスを要求しているコンピューターと同じ Active Directory サイト メンバーシップを持つサーバーが優先されます。

Exchange 2013 は、サイト対応のアプリケーションで、Active Directory トポロジを使用して、メッセージ ルーティングや、他の Exchange 2013 コンピューターで実行されているサービスとの通信を行います。Active Directory サイトは、ルーティング境界であるだけでなく、サービス検出の境界でもあります。

ドメイン メンバー コンピューターのサイト メンバーシップの確認は、ローカル IP アドレスと定義されたサブネットを比較してから、適切なサイト メンバーシップの関連付けを確認するため、一連の DNS クエリによって異なります。DNS クエリに関連するオーバーヘッドを減らすため、Exchange 2013 Active Directory スキーマの追加には Exchange サーバー オブジェクトの **msExchServerSite** 属性が含まれています。この属性の値は、Exchange サーバーの Active Directory サイトの識別名です。この属性は、各 Exchange サーバー オブジェクトのプロパティです。サイト メンバーシップの類似性がサーバー オブジェクトの属性として格納されている場合、DNS クエリに依存するのではなく、現在のトポロジを Active Directory から直接読み取ることができます。また、サイト メンバーシップの関連付けは、サブスクライブ済みのエッジ トランスポート サーバーなどのドメイン以外のコンピューターに対して有効になります。

**msExchServerSite** 属性の値は、Microsoft Exchange Active Directory トポロジ サービスによって入力され、最新の状態に保たれます。Windows ベースのコンピューターが起動されると、Net Logon サービスはそのコンピューターのサイト メンバーシップを確認します。Net Logon サービスはこの情報を使用して、ローカル コンピューターと同じ Active Directory サイト内にあるドメイン コントローラーを見つけ、それらのサーバーに対して承認および認証要求を発行します。Microsoft Exchange Active Directory トポロジ サービスは、**DsGetSiteName** API 呼び出しを使用して、Net Logon サービスからサイト メンバーシップの値を取得し、Active Directory サイトの識別名を、Active Directory 内の Exchange サーバー オブジェクトの **msExchServerSite** 属性に書き込みます。

次の表に、組織で Active Directory サイトを定義する方法を示します。この例では、3 つの Active Directory サイトが定義され、各 Active Directory サイトは複数の IP サブネットに関連付けられます。

**Active Directory サイトとサブネットの関連付けの例**


<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="header">
<th>Active Directory サイト名</th>
<th>関連付けられた IP サブネット</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p>サイト A</p></td>
<td><p>192.168.1.0/24</p>
<p>192.168.2.0/24</p></td>
</tr>
<tr class="even">
<td><p>サイト B</p></td>
<td><p>192.168.3.0/24</p>
<p>192.168.4.0/24</p></td>
</tr>
<tr class="odd">
<td><p>サイト C</p></td>
<td><p>192.168.5.0/24</p>
<p>192.168.6.0/24</p></td>
</tr>
</tbody>
</table>


Mailbox01 という名前のサーバーの IP アドレスが 192.168.1.1 である場合、このサーバーはサイト A のメンバーになります。サーバーの IP アドレスを変更することにより、サイトのメンバーシップを変更できます。Mailbox01 の IP アドレスを 192.168.2.1 に変更した場合、このサブネットもサイト A に関連付けられているため、サーバーの Active Directory サイト メンバーシップは変更されません。ただし、サーバーを移動し、IP アドレスを 192.168.3.1 に変更した場合、サーバーはサイト B のメンバーであると見なされます。

サブネットと Active Directory サイトの関連付けを変更した場合にも、サイト メンバーシップに変化が生じる可能性があります。たとえば、サブネット 192.168.3.0 をサイト B との関連付けから削除し、サイト A に関連付けると、IP アドレスが 192.168.3.1 のサーバーのサイト メンバーシップもサイト A に変わります。サイト メンバーシップの変化が生じた場合は、Exchange がルーティングを決定する際にこれらの変更が考慮されるように、常に Exchange で構成データを更新する必要があります。Active Directory サイト メンバーシップの変更が生じてから、トポロジの変更が完全に伝達されるまでに、待ち時間が生じる可能性があります。

ページのトップへ

## IP サイト リンク

サイト リンクは、Active Directory サイト間の論理パスです。サイト リンク オブジェクトは、均一なコストで通信できるサイトのセットを表します。サイト リンクは、物理的なネットワーク上のネットワーク パケットによって選択される実際のパスには対応していません。ただし、管理者によってサイト リンクに割り当てられるコストは、通常、基盤となるネットワークの信頼性、速度、および使用可能な帯域幅に関連しています。たとえば、Active Directory 管理者は、速度が 10 メガビット/秒 (Mbps) のネットワーク接続よりも、速度が 100 Mbps のネットワーク接続に低いコストを割り当てます。

既定では、すべてのサイト リンクは推移的です。つまり、サイト A にサイト B へのリンクがあり、サイト B にサイト C へのリンクがある場合、サイト A は推移的にサイト C にリンクされます。サイト A とサイト C の間の推移的なリンクは、*サイト リンク ブリッジ*とも呼ばれます。

Exchange は、IP サイト リンクのみを使用してその Active Directory サイト ルーティング トポロジを特定します。IP サイト リンクに割り当てられているコストは、ルーティング テーブルを計算する際に、Exchange のルーティング コンポーネントによって考慮されます。これらのコストは、メッセージの最終的な送信先への最小コストのルーティング パスを計算するために使用されます。

すべての Active Directory サイトは、少なくとも 1 つの IP サイト リンクに関連付けられる必要があります。`DEFAULTIPSITELINK` という名前の既定の IP サイト リンクが 1 つあります。Active Directory サイトを作成する場合は、サイトを IP サイト リンクと関連付ける必要があります。追加の IP サイト リンクを作成して目的のトポロジを実装するか、すべての Active Directory サイトを `DEFAULTIPSITELINK` に関連付けることができます。IP サイト リンクの一部になっているそれぞれの Active Directory サイトは、均一なコストでそのリンク内の他のすべてのサイトと直接通信できます。

次の図では、フォレスト内に 4 つの Active Directory サイトが構成されています。すべてのサイトは、`DEFAULTIPSITELINK` に関連付けられています。したがって、各 Active Directory サイトは、同じコスト メトリックを使用して、他のすべてのサイトと直接通信します。複数の通信パスが示されていますが、定義されている IP サイト リンクは 1 つだけです。

**単一の IP サイト リンクによるフル メッシュ トポロジ**

![単一の IP サイト リンクによるフル メッシュ トポロジ](images/JJ916681.af38d41d-e768-4221-ab4b-b782aa388b73(EXCHG.150).gif "単一の IP サイト リンクによるフル メッシュ トポロジ")

次の図では、フォレスト内に 4 つの Active Directory サイトが構成されています。このトポロジでは、管理者は IP サイト リンクを構成して、Active Directory サイトの*ハブとスポークのトポロジ*を作成しています。それぞれのスポーク サイトは、中央のサイトと直接通信でき、推移的な IP サイト リンクを使用して相互に通信することができます。

**Active Directory IP サイト リンクのハブとスポークのトポロジ**

![IP サイト リンクのハブとスポークのトポロジ](images/JJ916681.eca6cd51-8c2e-4996-81ea-070cd9766ef8(EXCHG.150).gif "IP サイト リンクのハブとスポークのトポロジ")

Exchange は、最小コストのパスを決定する際にサイト リンクを使用しますが、常に送信先の Exchange サーバーに直接メッセージを配信しようとすることに注意しなければなりません。たとえば、前の図に示したトポロジでサイト B のユーザーがメッセージをサイト C の別のユーザーに送信した場合、サイト B のメールボックス サーバーは、サイト C のメールボックス サーバーに直接接続します。メッセージを強制的にサイト A 経由にする場合は、そのサイトをハブ サイトとして有効にする必要があります。ハブ サイトの詳細については、後の「ハブ サイトの実装」を参照してください。

Active Directory 管理者は、フォレストの接続および通信要件に最も対応したトポロジを実装します。同じトポロジが Exchange によって使用されるため、現在のトポロジが効率的なメッセージング通信に対応していることを確認する必要があります。

サイト リンクの既定のコストは 100 です。有効なサイト リンクのコストは、1 から 99,999 までの数字で指定できます。冗長なリンクを指定した場合、低いコストが割り当てられているリンクが常に優先されます。Exchange 組織管理者は、Exchange 固有のコストを IP サイト リンクに割り当てることができます。Exchange コストが IP サイト リンクに割り当てられている場合、このコストが Exchange によって使用されます。コストが割り当てられていない場合は、Active Directory コストが使用されます。IP サイト リンクに Exchange コストを設定する方法の詳細については、このトピックで後述する「IP サイト リンクのコストの制御」を参照してください。Enterprise Administrators グループのメンバーシップを持つ管理者は、追加の IP サイト リンクを作成できます。

Active Directory サイト構成の詳細については、「[サイト トポロジの設計](https://go.microsoft.com/fwlink/p/?linkid=33551)」を参照してください。

ページのトップへ

## IP サイト リンクのコストの制御

Active Directory IP サイト リンクのコストは、WAN 内のすべてのネットワーク接続と比較した相対的なネットワーク速度に基づいており、信頼性が高く効率的なレプリケーション トポロジが得られるように設計されています。そのため、ほとんどの場合、既存の IP サイト リンクのコストは、Exchange のメッセージ ルーティングでも適切に機能します。ただし、既存の Active Directory サイトおよび IP サイト リンクのトポロジを文書化した後に、その Active Directory IP サイト リンクのコストおよびトラフィック フローのパターンが Exchange に最適でないことが確認された場合は、Exchange によって評価されたコストに調整を加えることができます。Active Directory ツールを使用して IP サイト リンクに割り当てられたコストを変更すると、環境全体に影響を与える可能性があります。代わりに Exchange 管理シェルで **Set-AdSiteLink** コマンドレットを使用して、Exchange 固有のコストを IP サイト リンクに割り当てます。たとえば、IP サイト リンク SITELINKAB に Exchange 固有のコストの値 25 を設定するには、シェルで次のコマンドを実行します。`Set-AdSiteLink SITELINKAB -ExchangeCost 25`.

Exchange 固有のコストが IP サイト リンクに割り当てられている場合、メッセージ ルーティングを考慮する際には Active Directory のコストよりも Exchange のコストが優先され、最小コストのルーティング パスを評価する場合には、Exchange のコストのみが考慮されます。

メッセージ ルーティング トポロジを Active Directory レプリケーション トポロジから分岐させる必要がある場合には、IP サイト リンクのコストの調整が役立ちます。Exchange コストは、ハブ サイトを使用するようにすべてのメッセージのルーティングを強制する際に使用できます。また、Exchange コストは、Active Directory サイトへの通信が失敗した場合にどのキューにメッセージを入れるかを制御するのにも使用できます。次の図は、4 つのサイトによる Active Directory トポロジを示します。

**IP サイト リンク上で構成された Exchange のコストによるトポロジ**

![IP サイト リンク上の Exchange のコストによるトポロジ](images/JJ916681.56ac2bab-99de-4ddf-b968-80cd34ab8c21(EXCHG.150).gif "IP サイト リンク上の Exchange のコストによるトポロジ")

上の図では、サイト C とサイト D の間のネットワーク接続は、Active Directory レプリケーション用にのみ使用される帯域幅の狭い接続で、メッセージのルーティングには使用するべきではありません。ただし、Active Directory IP サイト リンクのコストによって、他のすべての Active Directory サイトからサイト D への最小コストのルーティング パスにそのリンクが含まれます。そのため、メッセージはサイト C 内のサイト D のキューに配信されます。一方、Exchange 管理者は、サイト D が利用できなくなった場合にメッセージがサイト B でキューに入るように、最小コストのルーティング パスにサイト B を含めるように設定します。サイト C とサイト D の間の IP サイト リンク上で Exchange のコストを高くして、サイト D への最小コストのルーティング パスに IP サイト リンクが含まれないように構成することができます。

Exchange では、Active Directory IP サイト リンクに対する最大メッセージ サイズ制限を構成できます。既定では、Exchange では、異なる Active Directory サイトにある Exchange サーバー間で中継されるメッセージに対して最大メッセージ サイズは制限されません。**Set-AdSiteLink** コマンドレットを使用して Active Directory IP サイト リンクに最大メッセージ サイズを構成した場合、メッセージが最もコストの低いルーティング パスの Active Directory サイト リンクに構成されている最大メッセージ サイズ制限を越えると、そのメッセージに対して配信不能レポート (NDR) が生成されます。これは、帯域幅が狭い接続を介して通信する必要があるリモート Active Directory サイトに送信されるメッセージのサイズを制限するのに有効です。詳細については、「[メッセージ サイズの制限](message-size-limits-exchange-2013-help.md)」を参照してください。

ページのトップへ

## ハブ サイトの実装

Exchange 組織において、すべてのメッセージ配信を特定の Active Directory サイトに中継させなければならない場合があります。シェルを使用して、Active Directory サイトをハブ サイトとして指定することができます。Active Directory サイトをハブ サイトに指定すると、メッセージ配信に関係するサーバーの数が増えるためオーバーヘッドが増加します。たとえば、サイト A からサイト E に送信されるメッセージを考えます。最小コストのルーティング パスがサイト A - サイト B - サイト C - サイト D - サイト E であり、サイト C をハブ サイトとして指定する場合、メッセージはサイト A からサイト C に中継されてから、サイト C からサイト E に中継されます。

Active Directory サイトをハブ サイトとして指定するには、**Set-AdSite** コマンドレットを使用します。メッセージ配信の最小コストのルーティング パス上にハブ サイトが存在する場合、メッセージは、最終的な送信先に中継される前にキューに入れられ、ハブ サイトのメールボックス サーバーのトランスポート サービスによって処理されます。

最小コストのルーティング パスが選択された後で、ルーティング パス上にハブ サイトがあるかどうかが確認されます。ハブ サイトが構成されている場合、メッセージは宛先に中継される前にハブ サイトのメールボックス サーバーを通過します。最小コストのルーティング パス上に複数のハブ サイトがある場合、メッセージはルーティング パス上の各ハブ サイトを通過します。

このような中継のルーティングは、ハブ サイトが最小コストのルーティング パスに存在する場合にのみ有効です。次の図に、ハブ サイトの正しい使用方法を示します。この図で、サイト B はハブ サイトとして構成されています。サイト A からサイト D に中継されるメッセージは、サイト D に配信される前にサイト B に中継されます。

**ハブ サイトによるメッセージの配信**

![ハブ サイトによるメッセージの配信](images/JJ916681.93238bcb-6bbc-4a48-aeb0-09342a421b5b(EXCHG.150).gif "ハブ サイトによるメッセージの配信")

次の図は、IP サイト リンクのコストがハブ サイトへのルーティングにどのように影響するかを示します。このシナリオで、サイト B はハブ サイトとして指定されています。ただし、サイト B は他のサイト間の最小コストのルーティング パス上に存在していません。そのため、サイト A からサイト D に中継されるメッセージは、サイトサイト B に中継されません。Active Directory サイトは、他の 2 つのサイト間の最小コストのルーティング パス上にない場合、ハブ サイトとして使用されません。

**誤って構成されたハブ サイト**

![誤って構成されたハブ サイト](images/JJ916681.c010d4d8-5cd3-4b79-b7db-0367ba3cc287(EXCHG.150).gif "誤って構成されたハブ サイト")

すべての Active Directory サイトをハブ サイトとして構成できます。ただし、この構成を正しく機能させるためには、ハブ サイト内に少なくとも 1 つのメールボックス サーバーが必要になります。

ページのトップへ

## トポロジ検出

Active Directory トポロジは、次の必要な要素によって Exchange で使用可能になります。

  - Microsoft Exchange Active Directory トポロジ サービス。

  - Microsoft Exchange Transport サービス内のトポロジ検出モジュール。

Microsoft Exchange Active Directory トポロジ サービスは、すべての Exchange 2013 クライアント アクセス サーバーとメールボックス サーバーで実行されます。これらのサーバーは、Microsoft Exchange Active Directory トポロジ サービスを使用して、Exchange サーバーが Active Directory データの読み取りおよび書き込みに使用できるドメイン コントローラーとグローバル カタログ サーバーを検出します。Exchange が Active Directory において読み取りおよび書き込みを行う必要がある場合、Exchange 2013 は常に識別されたディレクトリ サーバーにバインドします。

トポロジ検出モジュールは、Microsoft Exchange Transport サービスの一部で、Active Directory トポロジに関する情報を Exchange サーバーに提供します。この API は、組織内の Exchange サーバーと役割を検出し、Active Directory 構成オブジェクトとの関係を確認します。構成データは、Active Directory から取得され、そのコンピューターで実行されている Exchange サービスがアクセスできるようにキャッシュされます。

トポロジ検出モジュールは、次の手順を実行して、Exchange ルーティング トポロジを生成します。

1.  データが Active Directory から読み取られます。次のすべてのオブジェクトが取得されます。
    
      - Active Directory サイト。
    
      - IP サイト リンク。
    
      - すべての Exchange サーバー。

2.  手順 1. で取得されるデータは、初期トポロジを作成し、関連する構成オブジェクトのリンクおよびマッピングを始めるために使用されます。

3.  Exchange サーバーは、Active Directory に格納されている Exchange サーバー オブジェクトからサイト属性値を取得することにより、Active Directory サイトと整合されます。

4.  ルーティング テーブルは、取得された情報の集合によって更新されます。

この処理によって、すべての Exchange 2013 サーバーは、組織内の他の Exchange サーバーを認識し、Exchange サーバーの互いの距離を把握します。

ページのトップへ

