---
title: 'アクティブ マネージャー: Exchange 2013 Help'
TOCTitle: アクティブ マネージャー
ms:assetid: f4be27b7-1d7c-47b4-87ac-bfdfcc046f00
ms:mtpsurl: https://technet.microsoft.com/ja-jp/library/Dd776123(v=EXCHG.150)
ms:contentKeyID: 48270261
ms.date: 05/23/2018
mtps_version: v=EXCHG.150
ms.translationtype: MT
---

# アクティブ マネージャー

 

_**適用先:** Exchange Server 2013_

_**トピックの最終更新日:** 2015-04-07_

Microsoft Exchange Server 2013 は、*アクティブ マネージャー*と呼ばれるコンポーネントを含んでいます。このコンポーネントは、データベース可用性グループ (DAG) およびメールボックス データベースのコピーを含む高可用性プラットフォームを管理します。アクティブ マネージャーは、すべてのメールボックス サーバー上の Microsoft Exchange Replication サービス (MSExchangeRepl.exe) 内部で実行されます。DAG のメンバーではないメールボックス サーバーには、アクティブ マネージャーの役割が 1 つあります。*スダンドアロン アクティブ マネージャー*の 1 つのみです。DAG のメンバーであるサーバーには、アクティブ マネージャーの役割が 2 つあります。*プライマリ アクティブ マネージャー* (PAM) と*スタンバイ アクティブ マネージャー* (SAM) の 2 つがあります。PAM は、DAG 内のアクティブ マネージャーの役割で、どのコピーをアクティブまたはパッシブにするのかを決定します。PAM は、トポロジの変更通知を取得し、サーバーの障害に対応します。PAM 役割を持つ DAG メンバーは、必ずクラスターのクォーラム リソース (既定のクラスター グループ) を現在所有しているメンバーです。クラスターのクォーラム リソースを所有するサーバーに障害が発生すると、PAM 役割は、自動的に存続しているサーバーに移動し、存続しているサーバーがクラスターのクォーラム リソースの所有権を取得します。また、保守やアップグレードのために、クラスターのクォーラム リソースをホストするサーバーをオフラインにする必要がある場合は、まず、PAM を DAG の別のサーバーに移動する必要があります。PAM は、データベース コピー間でのアクティブの指定の移動をすべて制御します(特定のタイミングでは、1 つのコピーのみアクティブにすることが可能で、そのコピーはマウントまたはマウント解除が可能です)。PAM は、ローカル データベースの障害およびローカル インフォメーション ストアの障害の検出といった、ローカル システム上の SAM 役割の機能も実行します。

SAM は、クライアント アクセス サービスまたはトランスポート サービスなどのアクティブ マネージャー クライアント コンポーネントを実行している Exchange の他のコンポーネントに、どのサーバーがメールボックス データベースのアクティブ コピーをホストするかについての情報を提供します。SAM は、ローカル データベースおよびローカル インフォメーション ストアの障害を検出します。データベースがレプリケートされている場合は、PAM にフェールオーバーを開始するよう要求し、障害に対応します。SAM は、フェールオーバーのターゲットを決定しません。また、PAM 内のデータベースの場所の状態を更新することもしません。アクティブなデータベース コピーの場所の状態にアクセスして、受信したデータベースのアクティブ コピーについてのクエリに応答します。


> [!NOTE]
> Exchange 2013 は、クラスター化されたアプリケーションではありません。代わりに、クラスター、グループ、クラスター ネットワーク (ハートビート)、ノード管理、クラスター レジストリ、およびいくつかの制御コード関数のために、clusapi.dll に実装されたクラスター ライブラリ関数を使用します。さらに、アクティブ マネージャーは、アクティブ データとパッシブ データ、およびマウントされたデータなど、クラスター データベース内 (別名、クラスター レジストリ) の現在のメールボックス データベース情報を格納します。情報は直接クラスター データベースに格納されますが、その他のコンポーネントによって直接アクセスされることはありません。



Exchange 2013 では、Microsoft Exchange レプリケーション サービスは定期的にすべてのマウントされたデータベースの状態を監視します。また、I/O エラーや障害がないか、Extensible Storage Engine (ESE) も監視します。このサービスで障害を検出すると、アクティブ マネージャーに通知されます。その後、アクティブ マネージャーは、マウントする必要があるデータベース コピーと、アクティブ マネージャーがそのデータベースのマウントに必要とする機能を決定します。さらに、最後にマウントされたデータベースのコピーに基づいて、メールボックス データベースのアクティブ コピーを追跡し、追跡結果の情報をクライアントの接続先のクライアント アクセス サーバーに提供します。

## 最適なコピー選択

レプリケートされたメールボックス データベースのアクティブ コピーへのアクセスを不可能にする障害が発生したとき、アクティブ マネージャーは複数のステップによって、影響を受けたデータベースのコピーからアクティブ化するための最適なパッシブ コピーを選択し、障害から回復します。このプロセスは、Exchange 2010 では最適なコピー選択 (BCS) と呼ばれ、現在、Exchange 2013 では最適なコピーとサーバーの選択 (BCSS) と呼ばれます。この通常のプロセスは、次の順序で発生します。

1.  管理可用性またはアクティブ マネージャーが障害を検出するか、または管理者がターゲットレス スイッチオーバーを開始します。

2.  PAM がBCSS の内部アルゴリズムを実行します。

3.  *最終ログからのコピーの試行* (ACLL) と呼ばれるプロセスが実行されます。これにより、障害またはスイッチオーバーの前に、アクティブなデータベース コピーをホストしていたサーバーから、不足しているログ ファイルのコピーを試みます。

4.  ACLL プロセスの完了後、データベース コピーをホストしているメールボックス サーバーの *AutoDatabaseMountDial* の値がアクティブになっているデータベースのコピーキューの長さと比較されます。この時点で、以下のいずれかの状態となります。
    
      - 不足しているログ ファイルの数が *AutoDatabaseMountDial* の値以下の場合、ステップ 5 が発生します。
    
      - 不足しているログ ファイルの数が *AutoDatabaseMountDial* の値より多い場合、アクティブ マネージャーは、次に利用できる最適なコピーがあれば、そのコピーをアクティブにしようとします。

5.  PAM は、リモート プロシージャ コール (RPC) を使用して Microsoft Exchange Information Store にマウント要求を発行します。この時点で、以下のいずれかの状態となります。
    
      - データベースがマウントされ、クライアントが利用できる状態になります。
    
      - データベースがマウントされず、PAM が次に最適なコピーがあれば、それに対してステップ 3 および 4 を実行します。

Exchange 2010 では、BCS プロセスが各データベース コピーの複数の側面を評価して、アクティブ化する最良のコピーを判別しました。これらには次のようなものがあります。

  - キューの長さをコピー

  - 再生キューの長さ

  - データベースの状態

  - コンテンツ インデックスの状態

Exchange 2013 では、アクティブ マネージャーは、同じ BCS チェックとフェーズをすべて実行していきますが、降順の正常性による制約の使用も含むようになります。特に、BCSS は、Exchange 2013 に組み込まれた管理可用性モニタリング コンポーネントの一部に当たる新しい複数の正常性チェックを含みます。新しくアクティブ マネージャーによって追加で実行されるチェックが 4 つあります (実行される順に以下に示します)。

1.  **すべて正常 (All Healthy)**   影響を受ける (すべての監視コンポーネントを含む) データベースのコピーをホストするサーバーが正常な状態にあることをチェックします。

2.  **最大で標準の正常性 (Up to Normal Healthy)**   影響を受け (すべての監視コンポーネントを含み) 優先度が標準であるデータベースのコピーをホストするサーバーが正常な状態にあることをチェックします。

3.  **すべてソースより良好 (All Better than Source)**   影響を受ける (監視コンポーネントを含む) データベースのコピーをホストするサーバーが、影響を受けるコピーをホストしている現在のサーバーよりも良い状態にあることをチェックします。

4.  **ソースと同等 (Same as Source)**   影響を受ける (監視コンポーネントを含む) データベースのコピーをホストするサーバーが、影響を受けるコピーをホストしている現在のサーバーと同等の状態にあることをチェックします。

モニタリング コンポーネント (たとえば、フェールオーバー レスポンダー) によってトリガーされたフェールオーバーの結果として BCSS が起動されると、ターゲット サーバーのコンポーネントの正常性がフェールオーバーが発生したサーバーよりも高くなければならないという追加の必須制約が適用されます。たとえば、Microsoft Office Outlook Web App の障害によりフェールオーバー レスポンダーを介してフェールオーバーがトリガーされると、BCSS は Outlook Web App が正常で、影響を受けたデータベースのコピーをホストしているサーバーを選択しなければなりません。

## 最適なコピー選択プロセス

Exchange 2013 のアクティブ マネージャーは、データベースの障害 (プロトコルの障害ではなく) に関しては Exchange 2010 で行われたのと同じチェックを実行します。アクティブ マネージャーは、アクティブ化の候補となる可能性のあるデータベース コピーの一覧を作成して、最適なコピー選択プロセスを開始します。到達不能なデータベース コピー、または管理上アクティブ化がブロックされているデータベース コピーは、選択プロセスでは無視され使用されません。この一覧の順序は、*AutoDatabaseMountDial* の値によって異なります。

  - *AutoDatabaseMountDial* がデータベースのコピーをホストするすべてのサーバー上で「`Lossless`」以外の値に構成されている場合、Active Manager は主キーとしてコピーキューの長さを使用して結果の一覧を並べ替えます。計算は (コピーから見た) LastLogInspected に基づくため、コピーの一覧は LastLogInspected の最大値 (コピー キューの長さが最短のコピー) から降順で並べ替えられます。必要に応じて、Active Manager は、2 つ以上のパッシブ コピーのコピー キューの長さが同一の場合にタイ ブレーク条件となる二次キーとしてアクティブ化の優先順位を使用し、2 回目の並べ替えを実行します。アクティブ化の優先順位の値が最も小さいコピーが、一覧でより上位の優先順位となります。

  - *AutoDatabaseMountDial* が、データベースのコピーをホストするサーバー上で `Lossless` に構成されている場合、アクティブ マネージャーは、結果の一覧をアクティブ化の優先順位の値を主キーとして使用して昇順で並べ替えます。さらに、管理者が対象を指定せずにロスレス サーバーまたはデータベースのスイッチオーバーを実行した場合も、Active Manager は、主キーとしてアクティブ化の優先順位の値を使用して結果の一覧を昇順に並べ替えます。

次に、アクティブ マネージャーは、状態が Healthy、DisconnectedAndHealthy、DisconnectedAndResynchronizing、または SeedingSource のメールボックス データベース コピーを一覧から探し、順序に関する 10 個の条件セットを使用して、一覧上の各コピーがアクティブ化できるかどうかを評価します。アクティブ マネージャーは、アクティブ化の候補が次の 1 番目の条件セットに合うどうかを判断します。

  - Healthy 状態のコンテンツのインデックスを持っている。

  - コピー キューの長さが 10 ログ ファイル未満。

  - 再生キューの長さが 50 ログ ファイル未満。

この 1 番目の条件セットに合うデータベース コピーがない場合は、アクティブ マネージャーは次の 2 番目の条件セットに合うデータベース コピーを探します。

  - クロール状態のコンテンツのインデックスを持っている。

  - コピー キューの長さが 10 ログ ファイル未満。

  - 再生キューの長さが 50 ログ ファイル未満。

この 2 番目の条件セットに合うデータベース コピーがない場合は、アクティブ マネージャーは次の 3 番目の条件セットに合うデータベース コピーを探します。

  - Healthy 状態のコンテンツのインデックスを持っている。

  - 再生キューの長さが 50 ログ ファイル未満。

この 3 番目の条件セットに合うデータベース コピーがない場合は、アクティブ マネージャーは次の 4 番目の条件セットに合うデータベース コピーを探します。

  - クロール状態のコンテンツのインデックスを持っている。

  - 再生キューの長さが 50 ログ ファイル未満。

この 4 番目の条件セットに合うデータベース コピーがない場合は、アクティブ マネージャーは次の 5 番目の条件セットに合うデータベース コピーを探します。

  - 再生キューの長さが 50 ログ ファイル未満。

この 5 番目の条件セットに合うデータベース コピーがない場合は、アクティブ マネージャーは次の 6 番目の条件セットに合うデータベース コピーを探します。

  - Healthy 状態のコンテンツのインデックスを持っている。

  - コピー キューの長さが 10 ログ ファイル未満。

この 6 番目の条件セットに合うデータベース コピーがない場合は、アクティブ マネージャーは次の 7 番目の条件セットに合うデータベース コピーを探します。

  - クロール状態のコンテンツのインデックスを持っている。

  - コピー キューの長さが 10 ログ ファイル未満。

この 7 番目の条件セットに合うデータベース コピーがない場合は、アクティブ マネージャーは次の 8 番目の条件セットに合うデータベース コピーを探します。

  - Healthy 状態のコンテンツのインデックスを持っている。

この 8 番目の条件セットに合うデータベース コピーがない場合は、アクティブ マネージャーは次の 9 番目の条件セットに合うデータベース コピーを探します。

  - クロール状態のコンテンツのインデックスを持っている。

この 9 番目の条件セットに合うデータベース コピーがない場合は、アクティブ マネージャーは、Healthy、DisconnectedAndHealthy、DisconnectedAndResynchronizing、または SeedingSource の状態を持つ任意のデータベース コピーのアクティブ化を試みます (10 番目の条件セット)。この 10 番目の条件セットに合うデータベース コピーが見つからない場合は、データベース コピーを自動的にアクティブ化することはできません。

1 つ以上の条件セットに合う 1 つ以上のコピーが見つかれば、ACLL プロセスが実行され、これから新しいアクティブ コピーとなるコピーに、元のソースからすべてのログ ファイルがコピーされます。ACLL プロセスの完了後、PAM がマウント要求を発行し、データベースがマウントされクライアントが利用できる状態になるか、データベースがマウントされず PAM が次に最適なコピーが利用できればそれを検索します。

