---
title: '管理ストア: Exchange 2013 Help'
TOCTitle: 管理ストア
ms:assetid: efdaf80b-335c-491c-8eb5-1fafd297e8a2
ms:mtpsurl: https://technet.microsoft.com/ja-jp/library/Dn792020(v=EXCHG.150)
ms:contentKeyID: 62606366
ms.date: 04/24/2018
mtps_version: v=EXCHG.150
ms.translationtype: HT
---

# 管理ストア

 

_**適用先:**Exchange Server 2013_

_**トピックの最終更新日:**2014-07-14_

以前のバージョンの Exchange Server (Exchange Server 4.0 から Exchange Server 2010 まで) すべては、メールボックス サーバーの役割で Information Store プロセス (Store.exe) の単一インスタンスを実行することをサポートしています。この単一 Store インスタンスは、サーバー上のすべてのデータベース (アクティブ、パッシブ、時間差、および回復) をホストします。以前の Exchange アーキテクチャでは、1 つのメールボックス サーバーでホストされているデータベース同士の分離は、あったとしてもごくわずかでした。単一のメールボックス データベースで問題が起こると、その他のすべてのデータベースに悪影響が及ぶ可能性があります。また、メールボックスの破損によるクラッシュによって、そのサーバーでホストされているデータベースのすべてのユーザーに対するサービスに影響が生じる可能性もあります。

旧バージョンの Exchange の単一 Store インスタンスに関する別の問題は、プロセッサのコア数が 8 から 12 なら Extensible Storage Engine (ESE) の拡張が良好であるものの、その数を超えるとプロセッサ間通信およびキャッシュ同期の問題によって拡張に悪影響が生じるというものです。これは、16 コアを上回るシステムを使用できる最近のさらに大規模なサーバーでは、ESE 用として 8 から 12 コアのアフィニティを管理し、Store プロセス以外 (たとえば、アシスタント、Search Foundation、可用性管理など) には他のコアを使用するという管理上の課題が生じることを意味します。その上、以前のアーキテクチャは Store プロセスのスケールアップを制限していました。

Exchange Server 自体が進化したように、Store.exe プロセスもここ数年で大幅に進化しました。しかし、単一プロセスであるため、結局はそのスケーラビリティは制限されており、これは単一障害点となります。これらの制限のために、Store.exe は Exchange 2013 では使用されなくなり、管理ストアに置き換えられました。

## 管理ストア

管理ストアは、Exchange Server 2013 における Information Store (Store とも呼ばれる) プロセスの名前です。管理ストアは、ストレージ プロセスの分離とより迅速なデータベース フェールオーバーを実現するコントローラー/ワーカー プロセス モデルを使用します。また、管理ストアには、以前のバージョンの Exchange Server での動的バッファー アルゴリズムの代わりとなる新しい静的データベース キャッシング メカニズムも含まれます。管理ストアによって使用されるマルチプロセス モデルには、単一のストア サービス コントローラー プロセス (この場合、Microsoft.Exchange.Store.Service.exe (別名 MSExchangeIS))、およびマウントされたデータベースごとに 1 つのワーカー プロセス (この場合、Microsoft.Exchange.Store.Worker.exe) が存在します。データベースをマウントすると、そのデータベースに対してのみサービスを提供する新しいワーカー プロセスのインスタンスが生成されます。データベースをマウント解除すると、そのデータベースのワーカー プロセスは削除されます。

たとえば、1 台のサーバーに 40 個のデータベースをマウントした場合、その管理ストアでは 41 個のプロセスが実行されます。つまり、各データベースに対して 1 つずつ、およびストア サービス プロセス コントローラーに対して 1 つ存在します。

ストア サービス プロセス コントローラーは徹底したシン設計であり、高い信頼性がありますが、停止したり終了させられたりすると、そのすべてのワーカー プロセスが停止します (これらのプロセスはサービス コントローラー プロセスが停止し、終了したことを検出します)。ストア プロセス コントローラーは、サーバー上のすべてのストア ワーカー プロセスの状態を監視します。Microsoft.Exchange.Store.Service.exe の強制的または予期しない終了は、アクティブなすべてのデータベース コピーの即時フェールオーバーを引き起こします。また、管理ストアは Microsoft Exchange Replication Service (MSExchangeRepl.exe) およびアクティブ マネージャーと密接に統合されています。コントローラー プロセス、ワーカー プロセス、およびレプリケーション サービスは一緒に機能して、より高い可用性および信頼性を提供します。

  - Microsoft Exchange Replication Service プロセス (MSExchangeRepl.exe)
    
      - Store へのマウントおよびマウント解除操作を担当する
    
      - Store、Extensible Storage Engine (ESE)、可用性管理レスポンダーによって報告されたストレージ障害またはデータベース障害に対する回復処理を開始する
    
      - 予期しないデータベース エラーを検出する
    
      - 管理タスク用の管理インターフェイスを提供する

  - ストア サービス プロセス/コントローラー (Microsoft.Exchange.Store.Service.exe)
    
      - レプリケーション サービスから受け取るマウントおよびマウント解除操作に基づく各ワーカー プロセスの有効期限を管理する
    
      - Windows サービス コントロール マネージャーからの受信要求を処理する
    
      - ストア ワーカー プロセスの問題 (たとえば、ハング、予期しない終了など) が検出された場合に障害項目をログに記録する
    
      - フェールオーバー イベントの応答としてストア ワーカー プロセスを終了する

  - ストア ワーカー プロセス (Microsoft.Exchange.Store.Worker.exe)
    
      - データベース上のメールボックスの RPC 操作の実行を行う
    
      - ワーカー プロセス内の RPC エンドポイント インスタンスはデータベース GUID である
    
      - データベースにデータベース キャッシュを提供する

## 静的データベース キャッシング アルゴリズム

Exchange Server 5.5 で導入された、動的バッファー割り当てとして知られるデータベース キャッシング アルゴリズムは、Exchange 2000 Server、Exchange Server 2003、Exchange Server 2007、および Exchange Server 2010 の Information Store によっても使用されていましたが、Exchange 2013 以降では使用されなくなりました。Exchange 2013 では、データベース キャッシュを決定するために非常にシンプルでわかりやすいアルゴリズムが使用されています。管理ストアは、フェールオーバーが発生したときにデータベース間で動的にキャッシュを再割り当てしなくなりました。これにより、内部のキャッシュ管理が非常に簡略化されました。その代わりに、各データベース キャッシュ (各ストア ワーカー プロセスなど) へのメモリの割り当ては、ローカル データベース コピーの数、および *MaximumActiveDatabases* の値 (構成されている場合) に基づいて行われます。*MaximumActiveDatabases* の値が現在のデータベース コピーの数より大きい場合、キャッシュの計算はデータベース コピーの数に基づいて行われます。

Exchange 2013 によって使用される静的アルゴリズムは、物理 RAM に基づいて各ストア ワーカー プロセスの ESE キャッシュにメモリを割り当てます。これは、データベースの*最大キャッシュ ターゲット*と呼ばれます。サーバー メモリの合計の 25% は ESE キャッシュに割り当てられます。これは、*サーバー キャッシュ サイズ ターゲット*と呼ばれます。


> [!NOTE]
> サーバー キャッシュ サイズ ターゲットと、それに伴って ESE キャッシュの Store に割り当てられるメモリの量は、Active Directory の <EM>InformationStore</EM> オブジェクトの <EM>msExchESEParamCacheSizeMax</EM> 属性を使用して上書きできます (構成される値は、すべてのストア プロセスにわたって割り当てる 32 KB ページの数です)。



静的なこのキャッシュの量は、アクティブ コピーおよびパッシブ コピーに割り当てられます。ストア ワーカー プロセスに最大キャッシュ ターゲットが割り当てられるのは、アクティブ データベース コピーを提供する場合のみです。パッシブ データベース コピーの場合、最大キャッシュ ターゲットの 20% が割り当てられます。残りは Store によって予約され、データベースがパッシブからアクティブに移行する場合にワーカー プロセスに割り当てられます。

最大キャッシュ ターゲットの計算は Store 起動時にのみ行われます。そのため、データベースまたはデータベース コピーを追加または削除する場合、その結果に応じてキャッシュを調整できるように、Store コントローラー サービス (MSExchangeIS) を再起動する必要があります。サービスが再起動されないと、新たに作成したデータベースのキャッシュ サイズ ターゲットはサービスが起動する前に作成されたデータベースよりも小さくなります。この場合、データベース キャッシュ サイズ ターゲットの合計は、MSExchangeIS が再起動するまで、サービス キャッシュ サイズ ターゲットを上回る可能性が高くなります。

## データベース キャッシュ計算の例

以下は、メールボックス サーバーのメモリおよびデータベース構成に基づいたデータベース キャッシング計算の例です。

**例 1**

この例では、メールボックス サーバーに 48 GB のメモリがあり、2 つのアクティブ データベースと 2 つのパッシブ データベースがホストされています。また、*MaximumActiveDatabases* パラメーターは構成されていません。この構成では、データベース キャッシュの容量は、アクティブ データベース コピーのワーカー プロセスにはそれぞれ 3 GB、パッシブ データベース コピーのワーカー プロセスにはそれぞれ 0.6 GB が割り当てられます。以下にこれらの値の算出方法を示します。

サーバー キャッシュ サイズ ターゲットを算出するため、メモリ容量を 25% で乗算します。

48 GB X 25% = 12 GB

データベース最大キャッシュ ターゲットを算出するため、サーバー キャッシュ サイズ ターゲットをアクティブ データベースとパッシブ データベースの合計数で除算します。

12 GB / 4 データベース = 3 GB

パッシブ データベース コピーに使用するメモリ容量を決定するため、データベース最大キャッシュ ターゲットを 20% で乗算します。

3 GB X 20% = 0.6 GB

サーバー キャッシュ サイズ ターゲットに割り当てられた 12 GB のうち、7.2 GB はデータベース ワーカー プロセスに使用されます。4.8 GB は、2 つのパッシブ データベース コピーがアクティブ コピーになる場合に備え、それらのコピーのために Information Store によって予約されます。この場合、3 GB の最大キャッシュ ターゲットを使用します。

**例 2**

この例でも、メールボックス サーバーに 48 GB のメモリがあり、2 つのアクティブ データベースと 2 つのパッシブ データベースがホストされていますが、*MaximumActiveDatabases* パラメーターが値 2 で構成されています。この構成では、データベース キャッシュの容量は、アクティブ データベース コピーのワーカー プロセスごとに 5 GB、パッシブ データベース コピーのワーカー プロセスごとに 0.2 GB です。以下にこれらの値の算出方法を示します。

サーバー キャッシュ サイズ ターゲットを算出するため、メモリ容量を 25% で乗算します。

48 GB X 25% = 12 GB

データベース最大キャッシュ ターゲットを算出するため、アクティブ データベースの合計数にパッシブ データベースの合計数の 20% を加えた数で、サーバー キャッシュ サイズ ターゲットを除算します。

12 GB / (2A + (2P X 20%)) = 5 GB

パッシブ データベース コピーに使用するメモリ容量を決定するため、データベース最大キャッシュ ターゲットを 20% で乗算します。

5 GB X 20% = 1 GB

サーバー キャッシュ サイズ ターゲットに割り当てられた 12 GB のメモリのうち、12 GB がデータベース ワーカー プロセスによって使用されます。2 つのパッシブ データベース コピーのために Information Store によって予約されるメモリはありません。これは、この構成ではパッシブ データベース コピーがアクティブ コピーになることがないためです (*MaximumActiveDatabases* が値 2 で構成されており、サーバー上に既に 2 つのアクティブ データベース コピーが存在しているためです)。

