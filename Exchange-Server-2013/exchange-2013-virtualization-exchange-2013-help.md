---
title: 'Exchange 2013 仮想化: Exchange 2013 Help'
TOCTitle: Exchange 2013 仮想化
ms:assetid: 36184b2f-4cd9-48f8-b100-867fe4c6b579
ms:mtpsurl: https://technet.microsoft.com/ja-jp/library/JJ619301(v=EXCHG.150)
ms:contentKeyID: 49129382
ms.date: 04/24/2018
mtps_version: v=EXCHG.150
ms.translationtype: HT
---

# Exchange 2013 仮想化

 

_**適用先:**Exchange Server 2013_

_**トピックの最終更新日:**2017-08-08_

Microsoft Exchange Server 2013 は仮想化環境に展開することができます。ここでは、ハードウェア仮想化ソフトウェア上に Exchange 2013 を展開する、サポートされているシナリオの概要を示します。

**目次**

ハードウェア仮想化の要件

ホスト マシンの記憶域要件

Exchange の記憶域要件

Exchange のメモリ要件および推奨事項

Exchange のホストベースのフェールオーバー クラスター化と移行

「Exchange の仮想化」では、以下の用語を使用します。

  - **コールド ブート**   電源オフの状態からオペレーティング システムを起動する操作を*コールド ブート*といいます。オペレーティング システムの状態は初期化されます。

  - **保存された状態**   通常、ハイパーバイザーには、仮想マシンの電源がオフになったときに仮想マシンの状態を保存する機能があり、マシンの電源が再度オンになったときに、コールド ブートによる起動を経ずに、*保存された状態*に戻すことができます。

  - **計画的な移行**   システム管理者が仮想マシンのハイパーバイザー ホスト間の移行を開始する場合、こうした操作は*計画的な移行*と呼ばれます。こうした操作は、1 回限りの移行の場合もあれば、システム管理者が設定した時間に仮想マシンを移行するように自動化する場合もあります。ハードウェアやソフトウェアの障害など、システム内でイベントが発生した結果、計画的な移行を行う場合もあります。要は、Exchange 仮想マシンが正常に動作していて、何らかの理由で再配置する必要がある場合を指します。Live Migration や vMotion のようなテクノロジによってこうした再配置を実行できます。ただし、Exchange 仮想マシンまたは仮想マシンのあるハイパーバイザー ホストに、何らかの障害が発生すると、計画した通りの結果は得られません。

## ハードウェア仮想化の要件

Microsoft は、以下の条件がすべて満たされる場合にのみ、ハードウェア仮想化ソフトウェアの運用環境で Exchange 2013 をサポートします。

  - ハードウェア仮想化ソフトウェアで次のいずれかが実行されている。
    
      - Windows Server のいずれかのバージョンに HYPER-V テクノロジやマイクロソフトの HYPER-V サーバー
    
      - [Windows Server Virtualization 検証プログラム](https://go.microsoft.com/fwlink/p/?linkid=125375) に基づいた検証済みのサードパーティのハイパーバイザー
    

    > [!NOTE]
    > すべてのサポート可能要件を満たしている場合、サービスとしてのインフラストラクチャ (IaaS) プロバイダーにおける Exchange 2013 の展開がサポートされます。仮想マシンをプロビジョニングするプロバイダーの場合、Exchange 仮想マシンで使用されているハイパーバイザーが完全にサポートされていること、Exchange が使用するインフラストラクチャが、サイジング プロセス中に判別されたパフォーマンス要件を満たしていることが要件として含まれます。Exchange データベースのすべての記憶域ボリュームおよびトランザクション ログ (トランスポート データベースを含む) が Azure Premium Storage 用に構成されている場合は、Microsoft Azure 仮想マシン上の展開がサポートされます。



  - Exchange ゲスト仮想コンピューターには、次の条件があります。
    
      - ゲスト仮想コンピューターで Exchange 2013 が実行されている。
    
      - ゲスト仮想コンピューターが Windows Server 2008 R2 SP1 (または以降のバージョン)、Windows Server 2012、または Windows Server 2012 R2 に展開されている。

Exchange 2013 の展開について:

  - 仮想マシンですべての Exchange 2013 サーバーの役割をサポートしている。

  - Exchange サーバーの仮想マシン (データベース可用性グループつまり DAG の一部となっている Exchange メールボックス仮想マシンなど) は、移動されたりオフラインになったりしたときにディスクの状態を保存または復元しないように仮想マシンが構成されている限り、ホストベースのフェールオーバー クラスター化および移行テクノロジと組み合わせることが可能です。ハイパーバイザー レベルで発生するフェールオーバー動作はすべて、フェールオーバー先のノードで仮想マシンがアクティブになったときに、コールド ブートする必要があります。計画されたすべての移行は、シャットダウンしてコールド ブートするか、Hyper-V ライブ移行のような技術を利用したオンライン移行になる必要があります。仮想マシンのハイパーバイザー移行はハイパーバイザー ベンダーがサポートするため、ハイパーバイザー ベンダーが Exchange 仮想マシンの移行をテストしており、サポートすることを確認する必要があります。Microsoft は、これらの仮想マシンの Hyper-V ライブ移行をサポートしています。

  - 管理ソフトウェア (ウイルス対策ソフトウェア、バックアップ ソフトウェア、仮想マシン管理ソフトウェアなど) のみ物理ホスト マシン上に展開できます。その他のサーバーベースのアプリケーション (Exchange、SQL Server、Active Directory、SAP など) はホスト マシンにインストールしないでください。ホスト マシンはゲスト仮想マシンの実行専用にする必要があります。

  - 一部のハイパーバイザーには、仮想マシン用のスナップショットを撮る機能が含まれています。仮想マシンのスナップショットは、実行中の仮想マシンの状態をキャプチャします。この機能により、仮想マシンの複数のスナップショットを撮り、スナップショットを仮想マシンに適用することで仮想マシンを以前の状態に戻すことができます。ただし、仮想マシンのスナップショットはアプリケーション対応ではなく、スナップショットの使用により、Exchange などの状態データを保持するサーバー アプリケーションで意図せず予期しない結果が発生する可能性があります。このため、Exchange ゲスト仮想マシンの仮想マシン スナップショットの作成はサポートされていません。

  - 多くのハードウェア仮想化製品では、各ゲスト仮想マシンに割り当てられる仮想プロセッサの数を指定できます。ゲスト仮想マシン内の仮想プロセッサは、物理システム内の固定数の物理プロセッサ コアを共有します。Exchange がサポートする仮想プロセッサと物理プロセッサ コアの比率は 2:1 以下ですが、推奨値は 1:1 です。たとえば、クアッド コア プロセッサを使用するデュアル プロセッサ システムでは、ホスト システムに合計 8 個の物理プロセッサ コアを使用します。この構成のシステムでは、すべてのゲスト仮想マシンで合わせて合計 16 を超える仮想プロセッサを割り当てないでください。

  - ホスト マシンによって必要になる仮想プロセッサの合計数を計算する場合には、I/O とオペレーティング システムの両方の要件も考慮する必要があります。ほとんどの場合、Exchange 仮想マシンをホストするシステムのホスト オペレーティング システムで必要となる仮想プロセッサに相当する数は 2 です。この値は、物理コアと仮想プロセッサの全体の比率を計算する際に、ホスト オペレーティング システムの仮想プロセッサのベースラインとして使用されます。ホスト オペレーティング システムのパフォーマンスの監視で、2 プロセッサに相当する以上の使用率でプロセッサを消費していることが示された場合は、ゲスト仮想マシンに割り当てられる仮想プロセッサの数を減らし、仮想プロセッサと物理コアの比率が 2:1 以下であることを確認する必要があります。

  - Exchange ゲスト マシンのオペレーティング システムは、最小 15 GB (ギガバイト) に加えてゲスト マシンに割り当てられる仮想メモリのサイズを含むサイズのディスクを使用する必要があります。この要件は、オペレーティング システムおよびページング ファイルのディスク要件に対応するために必要です。たとえば、ゲスト マシンに 16 GB のメモリが割り当てられる場合、ゲスト オペレーティング システムに必要な最小ディスク領域は 31 GB です。
    
    さらにゲスト仮想マシンが、ホスト マシンにインストールされているファイバー チャネルまたは SCSI ホスト バス アダプター (HBA) と直接通信できない場合があります。その場合、ホスト マシンのオペレーティング システムでアダプターを構成し、ゲスト仮想マシンへの論理ユニット番号 (LUN) を仮想ディスクまたはパススルー ディスクとして提示する必要があります。

  - Azure のコンピューティング リソースから外部ドメインにメールを送信する方法は、SMTP リレー (SMTP スマート ホストとも呼ばれる) の使用だけがサポートされています。Azure のコンピューティング リソースはメールを SMTP リレーに送信します。次に、SMTP リレー プロバイダーがそのメールを外部ドメインに配信します。Microsoft Exchange Online Protection は SMTP リレーのプロバイダーの 1 つですが、ほかにもサード パーティのプロバイダーが数多くあります。詳細については、Microsoft Azure サポート チームのブログ投稿記事「[Azure コンピューティング リソースから外部ドメインに電子メールを送信する](https://go.microsoft.com/fwlink/p/?linkid=799723)」をご覧ください。

ハードウェア仮想化の要件

## ホスト マシンの記憶域要件

各ホスト マシンに最低限必要なディスク領域は次のとおりです。

  - 一部のハードウェア仮想化アプリケーションのホスト マシンは、オペレーティング システムとそのコンポーネント用の記憶域領域を必要とする場合があります。たとえば、Windows Server 2008 R2 を Hyper-V で実行する場合、Windows Server 2008 の要件を満たすには、10 GB 以上の容量が必要です。詳細については、「[Windows Server 2008 R2 のシステム要件](https://go.microsoft.com/fwlink/p/?linkid=125378)」をご覧ください。オペレーティング システムのページング ファイル、管理ソフトウェア、クラッシュ回復 (ダンプ) ファイルをサポートするには、追加の記憶域領域が必要となります。

  - 一部のハイパーバイザーは、各ゲスト仮想マシンに固有のファイルをホスト マシンに保持します。たとえば、Hyper-V 環境では、ゲスト マシンごとに一時メモリ格納ファイル (BIN ファイル) が作成され、保持されます。各 BIN ファイルのサイズは、ゲスト マシンに割り当てられるメモリの容量に等しくなります。さらに、各ゲスト マシンにその他のファイルが作成され、ホスト マシンに保持される場合もあります。

  - ホスト マシンで Windows Server 2012 Hyper-V または Hyper-V 2012 を稼働していて、データベース可用性グループに Exchange メールボックス サーバーをホストするホストベースのフェールオーバー クラスターを構成している場合は、Microsoft サポート技術情報の記事「[2872325、Hyper-V のゲスト クラスター ノードの作成または結合ができない可能性](https://support.microsoft.com/kb/2872325)」のガイダンスに従うことをお勧めします。

ハードウェア仮想化の要件

## Exchange の記憶域要件

仮想化された Exchange サーバーに接続するストレージの要件は次のとおりです。

  - 各 Exchange ゲスト マシンには、ゲストのオペレーティング システム、使用中の一時メモリ格納ファイル、およびホスト マシンにホストされる関連仮想マシン ファイルを含む固定ディスクのための十分な記憶域領域をホスト マシン上で割り当てる必要があります。さらに、Exchange ゲスト マシンごとに、メッセージ キュー用の十分な記憶域と、データベース ファイルとログ ファイル用の十分な記憶域を、メールボックス サーバーで割り当ててください。

  - Exchange データ (メールボックス データベースやトランスポート キューなど) の記憶用に Exchange ゲスト マシンが使用する記憶域には、固定サイズの仮想記憶域 (Hyper-V 環境の固定仮想ハード ディスク (VHD または VHDX) など)、Hyper-V で VHDX ファイルを使用する場合の動的仮想記憶域、SCSI パススルー記憶域、またはインターネット SCSI (iSCSI) 記憶域があります。パススルー記憶域は、ホスト レベルで構成される、ゲスト マシン専用の記憶域です。Exchange データの記憶用に Exchange ゲスト マシンが使用する記憶域はすべてブロックレベルの記憶域とします。これは、このトピックで後述する SMB 3.0 シナリオ以外では、Exchange 2013 はネットワーク接続ストレージ (NAS) ボリュームの使用をサポートしないためです。また、ハイパーバイザーでブロックレベルのストレージとしてゲストに示されない NAS ストレージはサポートされません。

  - ゲスト コンピューターが Windows Server 2012 Hyper-V (またはそれ以降のバージョンの Hyper-V) で実行している場合、固定または動的仮想ディスクはブロックレベルの記憶域がバックアップする SMB 3.0 ファイルに格納できます。SMB 3.0 ファイル共有をサポートしている用途は、固定または動的仮想ディスクの記憶域のみです。このようなファイル共有は Exchange データの直接記憶域には使用できません。SMB 3.0 ファイル共有で固定または動的仮想ディスクを格納する場合、Exchange サービスの可用性をできるだけ保証するため、ファイル共有をバックアップする記憶域は高可用性に構成してください。

  - Exchange によって使用される記憶域は、ゲスト仮想マシンのオペレーティング システムをホストしている記憶域とは別のディスク スピンドルにホストする必要があります。

  - Exchange ゲスト仮想マシン内部で iSCSI イニシエーターを使用するように iSCSI 記憶域を構成することはサポートされています。ただし、仮想マシン内部のネットワーク スタックが完全な機能を備えていない (ジャンボ フレームをサポートしない仮想ネットワーク スタックもあります) 場合、この構成ではパフォーマンスが低下します。

ハードウェア仮想化の要件

## Exchange のメモリ要件および推奨事項

一部のハイパーバイザーには、同じハイパーバイザーによって管理されている他のゲスト マシンのニーズと比較し、ゲスト マシンの認識されたメモリ使用率に基づいて、特定のゲスト マシンが使用できるメモリの量をオーバーサブスクライブまたは動的に調整する機能があります。このテクノロジは、メモリが短時間必要で、その後、他の用途に引き渡せるような負荷には合理的です。ただし、メモリを継続的に使用するように設計された負荷に対しては合理的ではありません。Exchange は、メモリへのデータのキャッシュを含むパフォーマンス最適化機能を持つ多くのサーバー アプリケーションと同様に、自身が実行されている物理マシンや仮想マシンに割り当てられているメモリを十分に制御できない場合、システム パフォーマンスが低下したり、許容できないクライアントの動作が発生したりしやすくなります。したがって、動的メモリ機能は Exchange には使用できません。

ハードウェア仮想化の要件

## Exchange のホストベースのフェールオーバー クラスター化と移行

以下は、Exchange 2013 DAG によるホストベースのフェールオーバー クラスター化および移行テクノロジについてよく寄せられる質問に対する回答です。

  - **Microsoft は、サード パーティ製の移行テクノロジをサポートしていますか。**
    
    移行テクノロジは Server Virtualization Validation Program (SVVP) に含まれていないため、Microsoft は、サード パーティ製のハイパーバイザー製品の移行テクノロジと Exchange のインテグレーションをサポートしていると明言することはできません。SVVP は、サード パーティ製ハイパーバイザーのその他の要素をサポートしています。そのハイパーバイザー ベンダーが、そのベンダーの移行およびクラスタ化テクノロジと Exchange の組み合わせをサポートしているかどうかを確認する必要があります。ハイパーバイザー ベンダーがそのベンダーの移行テクノロジと Exchange の組み合わせをサポートしている場合、Microsoft は Exchange とそのベンダーの移行テクノロジをサポートしています。

  - **Microsoft では、ホスト ベースのフェールオーバー クラスター化をどのように定義していますか?**
    
    ホスト ベースのフェールオーバー クラスター化は、ホスト レベルの障害に自動的に反応し、影響を受ける仮想マシンを代替サーバー上で起動する機能を提供するあらゆるテクノロジを指します。こうしたテクノロジの使用がサポートされていると、障害が発生した場合、代替サーバー上で仮想マシンがコールド ブートで起動します。こうしたテクノロジによって、仮想マシンを、ディスクに保存された状態に戻さないようにすることができます。ディスクに保存された状態に戻すと、他の DAG メンバーよりも古い状態になるためです。

  - **移行のサポートとは、どのような意味ですか。**
    
    移行テクノロジとは、仮想マシンのホスト マシン間の計画的な移行を可能にするあらゆるテクノロジを指します。こうした移行を、リソースの負荷分散の一環として自動的に行うこともできますが、その場合、システムの障害とは連動していません。仮想マシンがディスクに保存された状態に戻らない限り、移行はサポートされます。つまり、状態と仮想マシンのメモリをネットワーク経由で転送してダウンタイムを認識させることなく仮想マシンを移行するテクノロジと、Exchange と使用がサポートされています。サード パーティ製のハイパーバイザー ベンダーは移行テクノロジをサポートしており、Microsoft はこうした構成での Exchange の使用をサポートしています。

ハードウェア仮想化の要件

