---
title: 'プロトコルのログ出力: Exchange 2013 Help'
TOCTitle: プロトコルのログ出力
ms:assetid: 40da446b-bcc3-4a97-ace7-a54f6ddebd79
ms:mtpsurl: https://technet.microsoft.com/ja-jp/library/Aa997624(v=EXCHG.150)
ms:contentKeyID: 49896223
ms.date: 04/24/2018
mtps_version: v=EXCHG.150
ms.translationtype: HT
---

# プロトコルのログ出力

 

_**適用先:** Exchange Server 2013_

_**トピックの最終更新日:** 2015-03-09_

メッセージング サーバー間でメッセージ配信の一部として行われる SMTP 通信は、プロトコル ログ出力に記録されます。これらの SMTP 通信は、クライアント アクセス サーバーのフロント エンド トランスポート サービス、メールボックス サーバーのトランスポート サービス、およびメールボックス サーバーのメールボックス トランスポート サービスに存在する送信コネクタと受信コネクタで行われます。プロトコルのログ出力を使用すると、メール フローの問題を診断できます。

既定では、プロトコルのログ出力はすべての送信コネクタと受信コネクタで無効になっています。プロトコルのログ出力の有効/無効は、各コネクタで指定できます。プロトコルのログ出力のその他のオプションは、サーバーの各トランスポート サービスに存在するすべての受信コネクタまたはすべての送信コネクタについて設定します。トランスポート サービスのすべての受信コネクタは、同じプロトコル ログ ファイルとプロトコル ログ オプションを共有します。これらのプロトコル ログ ファイルおよびプロトコル ログ オプションは、同じサーバーのトランスポート サービスの送信コネクタのプロトコル ログ ファイルやプロトコル ログ オプションとは別になっています。

Exchange サーバーの各トランスポート サービスに構成されているすべての送信コネクタまたはすべての受信コネクタのプロトコル ログに対して、以下のオプションを使用できます。

  - 送信コネクタまたは受信コネクタのプロトコル ログ ファイルの場所を指定します。

  - 送信コネクタまたは受信コネクタのプロトコル ログ ファイルの最大サイズを指定します。既定サイズは 10 MB です。

  - 送信コネクタまたは受信コネクタのプロトコル ログ ファイルを格納するディレクトリの最大サイズを指定します。既定のサイズは 250 MB です。

  - 送信コネクタまたは受信コネクタのプロトコル ログ ファイルの最大保存期間を指定します。既定の保存期間は 30 日です。

既定では、ログ ファイルが使用するハード ディスク容量を抑えるために、Exchange は循環ログを使用してファイルのサイズと保存期間に基づいてプロトコル ログを制限します。

組織内の送信コネクタという名前の特別な送信コネクタが、すべてのメールボックス サーバーのトランスポート サービスと、すべてのクライアント アクセス サーバーのフロント エンド トランスポート サービスに存在します。このコネクタは暗黙的に作成され、不可視で、管理は必要ありません。組織内の送信コネクタは、次のトランスポート サービスで使用されます。

  - **メールボックス サーバーのトランスポート サービス**
    
      - 組織内の他の Exchange 2013 メールボックス サーバーのトランスポート サービスとメールボックス トランスポート サービスにメッセージを中継します。
    
      - 組織内の他の Exchange 2007 または Exchange 2010 ハブ トランスポート サーバーにメッセージを中継します。
    
      - 境界ネットワーク内のエッジ トランスポート サーバーにメッセージを中継します。

  - **クライアント アクセス サーバーのフロント エンド トランスポート サービス**   組織の Exchange 2013 メールボックス サーバーのトランスポート サービスにメッセージを中継します。

メールボックス配信送信コネクタという名前の同等の送信コネクタが、すべてのメールボックス サーバーのメールボックス トランスポート サービスに存在します。このコネクタもまた暗黙的に作成され、不可視で、管理は必要ありません。メールボックス配信送信コネクタは、組織内の他のメールボックス サーバーのトランスポート サービスとメールボックス トランスポート サービスにメッセージを中継するのに使用されます。

既定では、メールボックス配信送信コネクタのプロトコルのログ出力も無効になっています。メールボックス配信送信コネクタのプロトコルのログ出力は、**Set-MailboxTransportService** コマンドレットの *MailboxDeliveryConnectorProtocolLoggingLevel* パラメーターを使用して有効または無効にできます。メールボックス配信送信コネクタのプロトコルのログ出力を有効にした場合、ログは、メールボックス サーバーのメールボックス トランスポート サービスの送信コネクタのプロトコル ログに出力されます。

**目次**

プロトコル ログ ファイルの構造

プロトコル ログに書き込まれる情報

## プロトコル ログ ファイルの構造

既定では、プロトコル ログ ファイルは以下の場所にあります。

  - **メールボックス サーバーのトランスポート サービスの受信コネクタ プロトコル ログ ファイル**   %ExchangeInstallPath%TransportRoles\\Logs\\Hub\\ProtocolLog\\SmtpReceive

  - **メールボックス サーバーのメールボックス トランスポート サービスの受信コネクタ プロトコル ログ ファイル**   %ExchangeInstallPath%TransportRoles\\Logs\\Mailbox\\ProtocolLog\\SmtpReceive

  - **クライアント アクセス サーバーのフロント エンド トランスポート サービスの受信コネクタ プロトコル ログ ファイル**   %ExchangeInstallPath%TransportRoles\\Logs\\FrontEnd\\ProtocolLog\\SmtpReceive

  - **メールボックス サーバーのトランスポート サービスの送信コネクタ プロトコル ログ ファイル**   %ExchangeInstallPath%TransportRoles\\Logs\\Hub\\ProtocolLog\\SmtpSend

  - **メールボックス サーバーのメールボックス トランスポート サービスの送信コネクタ プロトコル ログ ファイル**   %ExchangeInstallPath%TransportRoles\\Logs\\Mailbox\\ProtocolLog\\SmtpSend

  - **クライアント アクセス サーバーのフロント エンド トランスポート サービスの送信コネクタ プロトコル ログ ファイル**   %ExchangeInstallPath%TransportRoles\\Logs\\FrontEnd\\ProtocolLog\\SmtpSend

個々のプロトコル ログ ディレクトリにあるログ ファイルの名前付け規則は、*prefixyyyymmdd-nnnn*.log です。プレースホルダーは以下の情報を表しています。

  - プレースホルダー *prefix* は、送信コネクタでは SEND、受信コネクタでは RECV となります。

  - プレースホルダー *yyyymmdd* は、ログ ファイルが作成された協定世界時 (UTC) の日付です。プレースホルダー *yyyy* = 年、*mm* = 月、および *dd* = 日です。

  - プレースホルダー *nnnn* はインスタンス番号で、毎日値 1 から始まります。

ファイル サイズが指定された最大値に達すると、ログ ファイルに情報を書き込むのをやめ、インスタンス番号を増やした新しいログ ファイルを開きます。このプロセスを終日繰り返します。循環ログでは、プロトコル ログ ディレクトリが指定された最大サイズに達するか、またはログ ファイルが指定された最大保存期間に達すると、最も古いログ ファイルを削除します。

プロトコル ログ ファイルは、データをコンマ区切りファイル (CSV) 形式で格納するテキスト ファイルです。個々のプロトコル ログ ファイルには、以下の情報を含むヘッダーがあります。

  - **\#Software:**    プロトコル ログ ファイルを作成したソフトウェアの名前です。通常、この値は Microsoft Exchange Server です。

  - **\#Version:**    プロトコル ログ ファイルを作成したソフトウェアのバージョン番号です。現在、この値は 15.0.0.0 です。

  - **\#Log-Type:**    このフィールドのログ タイプの値です。SMTP Receive Protocol Log または SMTP Send Protocol Log です。

  - **\#Date:**    ログ ファイルが作成された UTC の日時です。UTC の日時は次のような ISO 8601 の日時形式で表されます。*yyyy-mm-dd*T*hh:mm:ss.fff*Z。ここで *yyyy* = 年、*mm* = 月、*dd* = 日です。T は時刻部分の先頭を表します。*hh* = 時、*mm* = 分、*ss* = 秒、*fff* = 秒の端数です。Z は Zulu (UTC の別称) を表します。

  - **\#Fields:**    プロトコル ログ ファイルで使用されているフィールド名をコンマで区切ったものです。

ページのトップへ

## プロトコル ログに書き込まれる情報

プロトコル ログでは、個々の SMTP プロトコル イベントが、プロトコル ログの 1 行として格納されます。各行の情報は、フィールドごとにまとめられています。これらのフィールドはコンマで区切られています。次の表は、各プロトコルの分類に使用されるフィールドの説明です。

### 各プロトコル イベントの分類に使用されるフィールド

<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="header">
<th>フィールド名</th>
<th>説明</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p><strong>date-time</strong></p></td>
<td><p>プロトコル イベントの日時 (UTC) です。UTC の日時は次のような ISO 8601 の日時形式で表されます。<em>yyyy-mm-dd</em>T<em>hh:mm:ss.fff</em>Z。ここで <em>yyyy</em> = 年、<em>mm</em> = 月、<em>dd</em> = 日です。T は時刻部分の先頭を表します。<em>hh</em> = 時、<em>mm</em> = 分、<em>ss</em> = 秒、<em>fff</em> = 秒の端数です。Z は Zulu (UTC の別称) を表します。</p></td>
</tr>
<tr class="even">
<td><p><strong>connector-id</strong></p></td>
<td><p>SMTP イベントに関連するコネクタの識別名 (DN) です。</p></td>
</tr>
<tr class="odd">
<td><p><strong>session-id</strong></p></td>
<td><p>各 SMTP セッションに固有で、その SMTP セッションに関連する各イベントに共通の GUID です。</p></td>
</tr>
<tr class="even">
<td><p><strong>sequence-number</strong></p></td>
<td><p>0 から始まり、同一 SMTP セッション内でイベントごとに増やされるカウンターです。</p></td>
</tr>
<tr class="odd">
<td><p><strong>local-endpoint</strong></p></td>
<td><p>SMTP セッションのローカル エンドポイントです。IP アドレスと TCP ポート番号で構成され、<em>&lt;IP アドレス&gt;</em>:<em>&lt;ポート&gt;</em> の形式で記述されます。</p></td>
</tr>
<tr class="even">
<td><p><strong>remote-endpoint</strong></p></td>
<td><p>SMTP セッションのリモート エンドポイントです。IP アドレスと TCP ポート番号で構成され、<em>&lt;IP アドレス&gt;</em>:<em>&lt;ポート&gt;</em> の形式で記述されます。</p></td>
</tr>
<tr class="odd">
<td><p><strong>event</strong></p></td>
<td><p>プロトコル イベントを 1 文字で表したものです。イベントの取り得る値は以下のとおりです。</p>
<ul>
<li><p><strong>+</strong>   接続</p></li>
<li><p><strong>-</strong>   切断</p></li>
<li><p><strong>&gt;</strong>   送信</p></li>
<li><p><strong>&lt;</strong>   受信</p></li>
<li><p><strong>*</strong>   情報</p></li>
</ul></td>
</tr>
<tr class="even">
<td><p><strong>data</strong></p></td>
<td><p>SMTP イベントに関連するテキスト情報です。</p></td>
</tr>
<tr class="odd">
<td><p><strong>context</strong></p></td>
<td><p>SMTP イベントに関連している可能性のある追加のコンテキスト情報です。</p></td>
</tr>
</tbody>
</table>


単一の電子メール メッセージの送信または受信を表す単一の SMTP 通信は、複数の SMTP イベントを生成します。これらの SMTP イベントによって、プロトコル ログに複数の行が書き込まれます。複数の電子メール メッセージの送信または受信を表す複数の SMTP 通信が、同時に発生する場合があります。その場合は、散在するさまざまな SMTP 通信から、プロトコル ログ エントリが作成されます。session-id フィールドと sequence-number フィールドを使用して、SMTP 通信ごとにプロトコル ログ エントリを並べ替えることが可能です。

ページのトップへ

