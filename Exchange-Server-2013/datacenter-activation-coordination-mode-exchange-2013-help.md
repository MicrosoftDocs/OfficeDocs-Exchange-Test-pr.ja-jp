---
title: 'データセンター ライセンス認証調整モード: Exchange 2013 Help'
TOCTitle: データセンター ライセンス認証調整モード
ms:assetid: 57e4bf22-eeae-42a5-beb3-d68d06489592
ms:mtpsurl: https://technet.microsoft.com/ja-jp/library/Dd979790(v=EXCHG.150)
ms:contentKeyID: 48269523
ms.date: 05/23/2018
mtps_version: v=EXCHG.150
ms.translationtype: MT
---

# データセンター ライセンス認証調整モード

 

_**適用先:** Exchange Server 2013_

_**トピックの最終更新日:** 2014-07-14_

データセンター ライセンス認証調整 (DAC) モードは、データベース可用性グループ (DAG) のプロパティです。DAC モードは既定では無効になっていますが、連続レプリケーションを使用する 2 つ以上のメンバーを持つすべての DAG で有効にする必要があります。サード パーティ レプリケーション モードを使用する DAG では DAC モードを有効にしないでください。ただし、サードパーティ ベンダーが指定した場合を除きます。

DAC モードは、DAG の起動時のデータベース マウント動作を制御するために使用されます。このコントロールは、データ センターのスイッチバック中にデータベース レベルでのスプリット ブレインの発生を防止するように設計されています。スプリット ブレインはスプリット ブレイン現象とも呼ばれており、この状態になると、通信できない同一 DAG の 2 つのメンバーに対してデータベース コピーがアクティブ コピーとしてマウントされます。DAC モードでは、データベースをマウントする前に、DAG メンバーがデータベースをマウントするための許可を得る必要があるため、DAC モードを使用するとスプリット ブレインを防止できます。

たとえば、プライマリ データセンターに 2 つの DAG メンバーと監視サーバーが含まれ、第 2 のデータセンターに他の 2 つの DAG メンバーが含まれているシナリオを考えてみましょう。このシナリオでは、DAG は DAC モードに設定されていません。プライマリ データセンターの電源が失われ、第 2 のデータセンターの DAG がアクティブになります。やがて、プライマリ データセンターの電源が復旧し、電源障害が発生する前のクォーラムを持つプライマリ データセンターの DAG メンバーは、起動してデータベースをマウントします。第 2 のデータセンターとのネットワーク接続が切断された状態でプライマリ データセンターが復旧し、DAG が DAC モードに設定されていない場合、DAG 内のアクティブなデータベースはスプリット ブレイン状態になります。

## DAC モードの機能

DAC モードは、データセンターのアクティブ化調整プロトコル (DACP) というプロトコルを使用することによってスプリット ブレインの発生を防ぐように設計されています。DAC モードが有効であれば、DAG メンバーがクォーラムを持つていてもデータベースは自動的にマウントされません。代わりに DACP が使用され、DAG の現在の状態と、アクティブ マネージャーがデータベースのマウントを試みる必要があるかどうかが確認されます。

DAC モードは、データベースをマウントするクォーラムのアプリケーション レベルと考えられているかもしれません。DACP の目的と機能を理解するには、DACP による処理を想定している第一のシナリオを理解することが重要です。2 つのデータ センター シナリオについて考えます。プライマリ データセンターで全面的な電源障害があるとします。この出来事で、すべてのサーバーと WAN がダウンしたため、スタンバイ データセンターをアクティブ化する決定が組織によって行われます。そのような回復シナリオのほぼすべてで、電源がプライマリ データセンターに回復したときに、WAN 接続が通常はすぐには回復しません。つまり、プライマリ データセンター内の DAG メンバーは電源がオンになりますが、それらはアクティブ化されたスタンバイ データセンター内の DAG メンバーと通信することができません。プライマリ データセンターには常に DAG クォーラム投票者の多数が含まれる必要があります。これは、電源が回復したときに、スタンバイ データセンター内の DAG メンバーへの WAN 接続がない場合でも、プライマリ データセンター内の DAG メンバーが多数を占めるため、クォーラムを保持します。これは、クォーラムが原因でこれらのサーバーがデータベースをマウントできる場合があり、その結果として、アクティブ化されたスタンバイ データセンターで現在マウントされている実際のアクティブ データベースと相違する可能性があるという問題です。

DACP は、この問題に対処するために作成されました。アクティブ マネージャーは、サーバー上でアクティブとして割り当てられたローカル データベースのマウントが許可されているかどうかを DAG に通知するメモリ内のビット (0 または 1) を保存します。DAG を DAC モードで実行すると、アクティブ マネージャーの起動時に常にビットが 0 に設定されるため、データベースをマウントできません。DAC モードであるため、サーバーは認識している DAG のその他のメンバーすべてと通信を試みて、別の DAG メンバーを取得し、それにアクティブとして割り当てられているローカル データベースのマウント可否について答えを得る必要があります。答えは、DAG 内のその他のアクティブ マネージャーのビット設定形式でわかります。別のサーバーからそのビットの設定が 1 であると返答される場合、それはサーバーがデータベースのマウントを許可されており、起動中のサーバーがそのビットを 1 と設定してそのデータベースをマウントするという意味です。

ただし、プライマリ データセンターの電源障害から回復するときにサーバーが回復したが WAN 接続が回復していない場合、プライマリ データセンター内のすべての DAG メンバーに 0 の DACP ビット値が 0 になり、その結果、回復したプライマリ データセンター内でバックアップを開始しているサーバーのいずれもデータベースをマウントしません。理由は、それらのいずれも DACP ビット値が 1 の DAG メンバーと通信できないからです。

## 2 つのメンバーを持つ DAG 用の DAC モード

2 つのメンバーを持つ DAG には、アプリケーションレベルのスプリット ブレイン現象に対して DACP ビットのみを完全に保護することを妨げる固有の制限があります。DAG が 2 つのメンバーのみで構成されている場合、DAC モードでは、起動時にデータベースをマウントできるかどうかを確認する際に DAG の監視サーバーの起動時間も使用されます。監視サーバーの起動時間と、DACP ビットが 1 に設定された時間を比較します。

  - DACP ビットを設定した時間がミラーリング監視サーバーの起動時間より前の場合、システムによって DAG メンバーとミラーリング監視サーバーは同時に再起動されたと見なされ (おそらくプライマリ データセンターで停電が発生したため)、DAG メンバーはデータベースのマウントが許可されません。

  - DACP ビットを設定した時間がミラーリング監視サーバーの起動時間より後の場合は、システムによって、他の理由で (おそらくメンテナンスを実施するためにスケジュールされた停止や、DAG メンバーに対して分離されたシステム クラッシュや停電のため) DAG メンバーが再起動されたと見なされます。DAG メンバーはデータベースのマウントが許可されます。


> [!IMPORTANT]
> DAG メンバーが起動時にアクティブなデータベースをマウントできるかどうかを決定する際に監視サーバーの起動時間が使用されるため、監視サーバーと唯一の DAG メンバーを同時に再起動しないようにする必要があります。このようにすると、DAG メンバーはスタートアップ時にデータベースをマウントできない状態のままになる場合があります。このような状況が発生した場合、DAG に対して <A href="https://technet.microsoft.com/ja-jp/library/dd351169(v=exchg.150)">Restore-DatabaseAvailabilityGroup</A> コマンドレットを実行する必要があります。このコマンドレットを実行すると、DACP ビットがリセットされ、DAG メンバーはデータベースのマウントが許可されます。



## DAC モードのその他の利点

アプリケーション レベルでのスプリットブレイン現象を防止するばかりでなく、DAC モードではデータセンターの切り替えを実行するために使用する組み込みのサイト復元コマンドレットを使用することもできます。これらには次のコマンドレットがあります。

  - [Stop-DatabaseAvailabilityGroup](https://technet.microsoft.com/ja-jp/library/dd335133\(v=exchg.150\))

  - [Restore-DatabaseAvailabilityGroup](https://technet.microsoft.com/ja-jp/library/dd351169\(v=exchg.150\))

  - [Start-DatabaseAvailabilityGroup](https://technet.microsoft.com/ja-jp/library/dd335076\(v=exchg.150\))

DAC モードでない DAG のデータセンターの切り替えを実行するには、Exchange ツールとクラスター管理ツールを組み合わせて使用する必要があります。詳細については、「[データセンターの切り替え](datacenter-switchovers-exchange-2013-help.md)」を参照してください。

## DAC モードの有効化

DAC モードは、Exchange 管理シェルによってのみ有効化できます。具体的には、次の例に示すように、[Set-DatabaseAvailabilityGroup](https://technet.microsoft.com/ja-jp/library/dd297934\(v=exchg.150\)) コマンドレットを使用して DAC モードを有効にできます。

```powershell
Set-DatabaseAvailabilityGroup -Identity DAG2 -DatacenterActivationMode DagOnly
```

前の例では、DAG2 で DAC モードが有効になりました。

DAC モードの有効化については、「[データベース可用性グループのプロパティを構成する](configure-database-availability-group-properties-exchange-2013-help.md)」と「[Set-DatabaseAvailabilityGroup](https://technet.microsoft.com/ja-jp/library/dd297934\(v=exchg.150\))」を参照してください。

