---
title: 'メール フロー ルールのテスト: Exchange Online Help'
TOCTitle: メール フロー ルールのテスト
ms:assetid: 3d949e2a-8ba4-4261-8cfb-736fd2446ea1
ms:mtpsurl: https://technet.microsoft.com/ja-jp/library/Dn831862(v=EXCHG.150)
ms:contentKeyID: 63145426
ms.date: 05/22/2018
mtps_version: v=EXCHG.150
ms.translationtype: HT
---

# メール フロー ルールのテスト

 

_**適用先:** Exchange Online, Exchange Online Protection, Exchange Server 2013_

Exchange のメール フロー ルール (トランスポート ルールとも呼ばれます) を作成するたびに、まずテストしてから有効にする必要があります。テストすると、作成した条件が誤っていて意図を正確に反映していなかったり、予期しない方法で他のルールと相互に影響したりする場合に、想定しない結果になるのを避けることができます。


> [!IMPORTANT]
> ルールを作成してからテストするまで 30 分待ってください。ルールを作成した直後にテストすると、動作が不整合になる場合があります。Exchange Server を使用していて複数の Exchange サーバーがある場合、すべてのサーバーがルールを受信するのに要する時間が長くなる場合があります。



## 手順 1: テスト モードでルールを作成する

テスト モードを選択すると、メール フローに影響するアクションを実行せずにルールの条件を評価できます。ルールが一致するたびに電子メール通知を受け取るようにルールを設定するか、ルールと一致する可能性があるメッセージに関するメッセージ トレースを参照することができます。次の 2 つのテスト モードがあります。

  - **ポリシー ヒントなしのテスト**。このモードはインシデント レポート アクションと併用し、電子メールがルールと一致するたびに電子メール メッセージを受信できます。

  - **ポリシー ヒントありのテスト**。このモードは、[データ損失防止](technical-overview-of-dlp-data-loss-prevention-in-exchange.md) (DLP) の使用時のみ利用できます。DLP は、Exchange Online や Exchange Online Protection (EOP) のサブスクリプション プランの一部と併用できます。このモードを使用すると、送信者が送信しようとしているメッセージがポリシーと一致している場合にメッセージが送信者に設定されますが、メール フロー アクションは実行されません。

インシデント レポート アクションを組み込んだ場合に、ルールが一致すると次のような内容が表示されます。

![ルールが検出されると送信されるメッセージ](images/Dn831862.c1a2db60-3fb9-4ddc-86d5-1757e2250f59(EXCHG.150).png "ルールが検出されると送信されるメッセージ")

**テスト モードとインシデント レポート アクションを併用する方法**

1.  Exchange 管理センター (EAC) で、**\[メール フロー\]** \> **\[ルール\]** に移動します。

2.  新しいルールを作成するか、既存のルールを選択してから、**\[編集\]** を選択します。

3.  **\[このルールのモードの選択\]** セクションまで下にスクロールしてから、**\[ポリシー ヒントなしのテスト\]** または **\[ポリシー ヒントありのテスト\]** を選択します。

4.  次のようにインシデント レポート アクションを追加します。
    
    1.  **\[アクションの追加\]** が表示されている場合は選択し、表示されていない場合は **\[その他のオプション\]** を選択してから **\[アクションの追加\]** を選択します。
    
    2.  **\[インシデント レポートを生成し送信する\]** を選択します。
    
    3.  **\[1 つ選択してください…\]** をクリックして自分か他のユーザーを選択します。
    
    4.  **\[メッセージ プロパティを含める\]** を選択してから、受信する電子メールに含めるメッセージ プロパティを選択します。いずれも選択しない場合は、引き続きルールが一致する場合に電子メールを受け取ります。

5.  **\[保存\]** を選択します。

## 手順 2: ルールが想定どおりかどうかを評価する

ルールをテストするには、予期したとおりか確認できるだけの数のテスト メッセージを送信するか、組織内のユーザーが送信するメッセージに関するメッセージ トレースを参照できます。次の種類のメッセージを評価できることを確認してください。

  - ルールに一致すると予期しているメッセージ

  - ルールに一致すると予期していないメッセージ

  - 組織内のユーザーが送受信するメッセージ

  - 組織外のユーザーが送受信するメッセージ

  - ルールと一致するメッセージに対する返信

  - 複数のルール間の相互影響が生じる可能性のあるメッセージ

## テスト メッセージを送信する場合のヒント

テストする方法の 1 つは、テスト メッセージの送信者と受信者の両方としてサインインすることです。

  - 組織内に複数のアカウントへのアクセス権がない場合、[Office 365 の無料試用版のアカウント](https://go.microsoft.com/fwlink/p/?linkid=402791)でテストするか、組織内で一時的な擬似ユーザーを少数作成できます。

  - 通常は、同一のコンピューター上で Web ブラウザーにより複数のアカウントにサインインして複数のセッションを同時に開くことはできないので、[Internet Explorer InPrivate ブラウズ](https://go.microsoft.com/fwlink/p/?linkid=402784)を使用するか、またはユーザーごとに別のコンピューター、デバイス、Web ブラウザーを使用できます。

## メッセージ トレースを参照する

メッセージ トレースには、メッセージに一致するルールごと、およびルールが実行するアクションごとに 1 つずつエントリが含まれています。これは、テスト メッセージがどうなるかを追跡したり、組織を経由してやり取りされる実際のメッセージがどうなるかを追跡したりするのに役立ちます。

![トランスポート ルール アクションを示すメッセージ トレース](images/Dn831862.64179f28-5c8c-421b-b630-cc1f7de9a34f(EXCHG.150).png "トランスポート ルール アクションを示すメッセージ トレース")

1.  EAC で、**\[メール フロー\]** \> **\[メッセージの追跡\]** に移動します。

2.  送信者や送信日などの条件を使用して、追跡対象のメッセージを検索します。条件の指定については、「[メッセージの追跡を実行し、結果を表示する](https://technet.microsoft.com/ja-jp/library/jj200712\(v=exchg.150\))」を参照してください。

3.  追跡対象のメッセージを見つけたらダブルクリックして、そのメッセージに関する詳細情報を表示します。

4.  **\[イベント\]** の **\[トランスポート ルール\]** 列を参照します。**\[アクション\]** 列には、実行される特定のアクションが表示されます。

## 手順 3: テストの完了後に適用対象のルールを設定する

1.  EAC で、**\[メール フロー\]** \> **\[ルール\]** に移動します。

2.  ルールを選択してから、**\[編集\]** を選択します。

3.  **\[強制\]** を選択します。

4.  インシデント レポートを生成するアクションを使用した場合、このアクションを選択してから **\[削除\]** を選択します。

5.  **\[保存\]** を選択します。


> [!TIP]
> 新しいルールについてユーザーに通知すると、驚かせずに済みます。



## トラブルシューティング方法

一般的な問題と解決策を次に示します。

  - **すべて正しいように思えますが、ルールが動作していません。**
    
    新しいメール フローを使うことができるようになるまでに 15 分より長くかかることもあります。数時間待ってからもう一度テストしてください。別のルールが干渉しているかどうかも確認してください。このルールを一覧の一番上に移動して、優先度を 0 に変更してみてください。

  - **免責事項が元のメッセージだけでなく、元のメッセージとすべての返信に追加されます。**
    
    これを避けるには、免責事項内の一意の語句を検索する免責事項ルールに例外を追加できます。

  - **ルールに 2 つの条件があり、どちらかの条件が満たされた場合にアクションが実行されるようにしようとしているが、両方の条件が満たされた場合のみルールが一致します。**
    
    条件ごとに 1 つずつ、合計 2 つのルールを作成する必要があります。**\[コピー\]** を選択するとルールを簡単にコピーできるので、その後コピー元のルールから 1 つの条件を削除し、コピーからもう 1 つの条件を削除します。

  - **配布グループを処理していますが、** **\[送信者が\]** (**SentTo**) **が動作していないように思われます。**
    
    **SentTo** は受信者のいずれかがメールボックス、メールが有効なユーザー、または連絡先のメッセージと一致しますが、この条件を使用して配布グループを指定できません。代わりに、**\[\[宛先\] ボックスにこのグループのメンバーを含む\]** (**SentToMemberOf**) を使用してください。

## その他のテストのオプション

Exchange Online か Exchange Online Protection を使っている場合は、ルール レポートを使って、各ルールが一致した回数を確認できます。ルールをレポートに組み込むには、ルールの **\[このルールを次の重大度レベルで監査する\]** チェック ボックスをオンにする必要があります。これらのレポートは、ルールの使用状況の傾向を把握し、一致しないルールを識別するために役立ちます。

ルール レポートを表示するには、Office 365 管理センター で、**\[レポート\]** を選択します。


> [!NOTE]
> レポート内のほとんどのデータは 24 時間以内のものですが、表示されるまでに 5 日かかるデータもあります。



![ルールの使用状況を示すレポート](images/Dn831862.df5bf202-741d-432a-b71d-b37143f0ec0a(EXCHG.150).png "ルールの使用状況を示すレポート")

詳細については、「[メール保護レポートの表示](https://go.microsoft.com/fwlink/p/?linkid=402958)」を参照してください。

## サポートが必要な場合

[メール フロー ルールを管理します](manage-mail-flow-rules-exchange-2013-help.md)

[Exchange Online のメール フロー ルール (トランスポート ルール)](https://technet.microsoft.com/ja-jp/library/jj919238\(v=exchg.150\)) (Exchange Online)

[Exchange Online Protection のメール フロー ルール (トランスポート ルール)](https://technet.microsoft.com/ja-jp/library/dn271424\(v=exchg.150\)) (Exchange Online Protection)

[メール フローやトランスポート ルール](mail-flow-rules-transport-rules-in-exchange-2013-exchange-2013-help.md) (Exchange Server)

